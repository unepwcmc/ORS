<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: LoopSource
  
    &mdash; Documentation by YARD 0.7.2
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (L)</a> &raquo; 
    
    
    <span class="title">LoopSource</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: LoopSource
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">ActiveRecord::Base</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActiveRecord::Base</li>
          
            <li class="next">LoopSource</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">app/models/loop_source.rb</dd>
  
</dl>
<div class="clear"></div>



  


  

  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_item_types-class_method" title="get_item_types (class method)">+ (Object) <strong>get_item_types</strong>(params) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
get the available item types for this section.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parse_search-class_method" title="parse_search (class method)">+ (Object) <strong>parse_search</strong>(cells, search_index, search_string, operator, language) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clone_loop_source-instance_method" title="#clone_loop_source (instance method)">- (Object) <strong>clone_loop_source</strong>(loop_sources_link, loop_item_types_link, loop_items_link, loop_item_names_link, extras_link) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_new_structure-instance_method" title="#create_new_structure (instance method)">- (Object) <strong>create_new_structure</strong>(status, item_types) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete_record-instance_method" title="#delete_record (instance method)">- (Object) <strong>delete_record</strong>(params) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fill_jqgrid-instance_method" title="#fill_jqgrid (instance method)">- (Object) <strong>fill_jqgrid</strong>(grid_details, params) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#matching_structure%3F-instance_method" title="#matching_structure? (instance method)">- (Boolean) <strong>matching_structure?</strong>(status, item_types) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parse_file-instance_method" title="#parse_file (instance method)">- (Object) <strong>parse_file</strong>(status, source_file_obj) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
load the loop_items of a oop_source from a file.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parse_loop_source_files-instance_method" title="#parse_loop_source_files (instance method)">- (Object) <strong>parse_loop_source_files</strong>(user_id, user_ip) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parse_source_headers-instance_method" title="#parse_source_headers (instance method)">- (Object) <strong>parse_source_headers</strong>(status, item_types, existing_structure) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#unparsed_sources%3F-instance_method" title="#unparsed_sources? (instance method)">- (Boolean) <strong>unparsed_sources?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Methods.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_records-instance_method" title="#update_records (instance method)">- (Object) <strong>update_records</strong>(params) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_sections-instance_method" title="#update_sections (instance method)">- (Object) <strong>update_sections</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  

  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="get_item_types-class_method">
  
    + (<tt>Object</tt>) <strong>get_item_types</strong>(params) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
get the available item types for this section
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


203
204
205
206</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/loop_source.rb', line 203</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='get_item_types identifier id'>get_item_types</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='rparen token'>)</span>
  <span class='loop_source identifier id'>loop_source</span> <span class='assign token'>=</span> <span class='LoopSource constant id'>LoopSource</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:id</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='@loop_types ivar id'>@loop_types</span> <span class='assign token'>=</span> <span class='loop_source identifier id'>loop_source</span><span class='dot token'>.</span><span class='loop_item_type identifier id'>loop_item_type</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="parse_search-class_method">
  
    + (<tt>Object</tt>) <strong>parse_search</strong>(cells, search_index, search_string, operator, language) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


296
297
298</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/loop_source.rb', line 296</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='parse_search identifier id'>parse_search</span><span class='lparen token'>(</span><span class='cells identifier id'>cells</span><span class='comma token'>,</span> <span class='search_index identifier id'>search_index</span><span class='comma token'>,</span> <span class='search_string identifier id'>search_string</span><span class='comma token'>,</span> <span class='operator identifier id'>operator</span><span class='comma token'>,</span> <span class='language identifier id'>language</span><span class='rparen token'>)</span>
  <span class='cells identifier id'>cells</span><span class='dot token'>.</span><span class='reject identifier id'>reject</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='a identifier id'>a</span><span class='bitor op'>|</span> <span class='a identifier id'>a</span><span class='lbrack token'>[</span><span class='search_index identifier id'>search_index</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='not_a_match? fid id'>not_a_match?</span><span class='lparen token'>(</span><span class='operator identifier id'>operator</span><span class='comma token'>,</span> <span class='search_string identifier id'>search_string</span><span class='comma token'>,</span> <span class='language identifier id'>language</span><span class='rparen token'>)</span><span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="clone_loop_source-instance_method">
  
    - (<tt>Object</tt>) <strong>clone_loop_source</strong>(loop_sources_link, loop_item_types_link, loop_items_link, loop_item_names_link, extras_link) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/loop_source.rb', line 208</span>

<span class='def def kw'>def</span> <span class='clone_loop_source identifier id'>clone_loop_source</span><span class='lparen token'>(</span><span class='loop_sources_link identifier id'>loop_sources_link</span><span class='comma token'>,</span> <span class='loop_item_types_link identifier id'>loop_item_types_link</span><span class='comma token'>,</span> <span class='loop_items_link identifier id'>loop_items_link</span><span class='comma token'>,</span> <span class='loop_item_names_link identifier id'>loop_item_names_link</span><span class='comma token'>,</span> <span class='extras_link identifier id'>extras_link</span><span class='rparen token'>)</span>
  <span class='new_loop_source identifier id'>new_loop_source</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='clone_object identifier id'>clone_object</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='symbol val'>:name</span><span class='comma token'>,</span> <span class='symbol val'>:source_files</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='new_loop_source identifier id'>new_loop_source</span><span class='dot token'>.</span><span class='loop_item_type identifier id'>loop_item_type</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='loop_item_type identifier id'>loop_item_type</span><span class='dot token'>.</span><span class='clone_loop_item_type identifier id'>clone_loop_item_type</span><span class='lparen token'>(</span><span class='loop_item_types_link identifier id'>loop_item_types_link</span><span class='comma token'>,</span> <span class='loop_items_link identifier id'>loop_items_link</span><span class='comma token'>,</span> <span class='loop_item_names_link identifier id'>loop_item_names_link</span><span class='comma token'>,</span> <span class='extras_link identifier id'>extras_link</span><span class='rparen token'>)</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='loop_item_names identifier id'>loop_item_names</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='lname identifier id'>lname</span><span class='bitor op'>|</span>
    <span class='new_loop_source identifier id'>new_loop_source</span><span class='dot token'>.</span><span class='loop_item_names identifier id'>loop_item_names</span> <span class='lshft op'>&lt;&lt;</span> <span class='loop_item_names_link identifier id'>loop_item_names_link</span><span class='lbrack token'>[</span><span class='lname identifier id'>lname</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>
  <span class='comment val'>#restore hierarchy between loop_items, for the cloned loop_items</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='loop_item_type identifier id'>loop_item_type</span><span class='dot token'>.</span><span class='self_and_descendants identifier id'>self_and_descendants</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='item_type identifier id'>item_type</span><span class='bitor op'>|</span>
    <span class='item_type identifier id'>item_type</span><span class='dot token'>.</span><span class='loop_items identifier id'>loop_items</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='item identifier id'>item</span><span class='bitor op'>|</span>
      <span class='unless unless kw'>unless</span> <span class='item identifier id'>item</span><span class='dot token'>.</span><span class='root? fid id'>root?</span>
        <span class='loop_items_link identifier id'>loop_items_link</span><span class='lbrack token'>[</span><span class='item identifier id'>item</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='parent identifier id'>parent</span> <span class='assign token'>=</span> <span class='loop_items_link identifier id'>loop_items_link</span><span class='lbrack token'>[</span><span class='item identifier id'>item</span><span class='dot token'>.</span><span class='parent identifier id'>parent</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='loop_sources_link identifier id'>loop_sources_link</span><span class='lbrack token'>[</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='new_loop_source identifier id'>new_loop_source</span>
  <span class='new_loop_source identifier id'>new_loop_source</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="create_new_structure-instance_method">
  
    - (<tt>Object</tt>) <strong>create_new_structure</strong>(status, item_types) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/loop_source.rb', line 167</span>

<span class='def def kw'>def</span> <span class='create_new_structure identifier id'>create_new_structure</span><span class='lparen token'>(</span><span class='status identifier id'>status</span><span class='comma token'>,</span> <span class='item_types identifier id'>item_types</span><span class='rparen token'>)</span>
  <span class='comment val'>#remove the '#' character, since it is no longer needed</span>
  <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:headers</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='slice! fid id'>slice!</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='rparen token'>)</span>
  <span class='comment val'>#add the item_types to the database</span>
  <span class='header_parent identifier id'>header_parent</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:headers</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='header identifier id'>header</span><span class='bitor op'>|</span>
    <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='header identifier id'>header</span>
      <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:errors</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;Error in the header line, please check your file.&quot;</span>
      <span class='return return kw'>return</span> <span class='false false kw'>false</span>
    <span class='else else kw'>else</span>
      <span class='item_type identifier id'>item_type</span> <span class='assign token'>=</span> <span class='LoopItemType constant id'>LoopItemType</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='header identifier id'>header</span><span class='rparen token'>)</span>
      <span class='if if kw'>if</span> <span class='header_parent identifier id'>header_parent</span>
        <span class='item_type identifier id'>item_type</span><span class='dot token'>.</span><span class='parent identifier id'>parent</span> <span class='assign token'>=</span> <span class='header_parent identifier id'>header_parent</span>
      <span class='else else kw'>else</span>
        <span class='comment val'>#associated first item_type with the loop_source | the next item types will be descendants of the first</span>
        <span class='comment val'># to keep the hierarchy between item types</span>
        <span class='self self kw'>self</span><span class='dot token'>.</span><span class='loop_item_type identifier id'>loop_item_type</span> <span class='assign token'>=</span> <span class='item_type identifier id'>item_type</span>
      <span class='end end kw'>end</span>
      <span class='begin begin kw'>begin</span>
        <span class='item_type identifier id'>item_type</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
      <span class='rescue rescue kw'>rescue</span>
        <span class='cd identifier id'>cd</span> <span class='assign token'>=</span> <span class='CharDet constant id'>CharDet</span><span class='dot token'>.</span><span class='detect identifier id'>detect</span><span class='lparen token'>(</span><span class='header identifier id'>header</span><span class='rparen token'>)</span>
        <span class='item_type identifier id'>item_type</span><span class='dot token'>.</span><span class='name identifier id'>name</span> <span class='assign token'>=</span> <span class='Iconv constant id'>Iconv</span><span class='dot token'>.</span><span class='iconv identifier id'>iconv</span><span class='lparen token'>(</span><span class='string val'>'utf-8'</span><span class='comma token'>,</span> <span class='cd identifier id'>cd</span><span class='lbrack token'>[</span><span class='string val'>'encoding'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='header identifier id'>header</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
        <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='item_type identifier id'>item_type</span><span class='dot token'>.</span><span class='save! fid id'>save!</span>
          <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:errors</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='header identifier id'>header</span> <span class='plus op'>+</span> <span class='string val'>&quot;: Please check the character encoding of your file.&quot;</span>
          <span class='return return kw'>return</span> <span class='false false kw'>false</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
      <span class='item_types identifier id'>item_types</span><span class='dot token'>.</span><span class='merge! fid id'>merge!</span><span class='lparen token'>(</span><span class='item_type identifier id'>item_type</span><span class='dot token'>.</span><span class='name identifier id'>name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='item_type identifier id'>item_type</span><span class='rparen token'>)</span>
      <span class='header_parent identifier id'>header_parent</span> <span class='assign token'>=</span> <span class='item_type identifier id'>item_type</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='true true kw'>true</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="delete_record-instance_method">
  
    - (<tt>Object</tt>) <strong>delete_record</strong>(params) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/loop_source.rb', line 272</span>

<span class='def def kw'>def</span> <span class='delete_record identifier id'>delete_record</span> <span class='params identifier id'>params</span>
  <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:leaf_id</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='leaf_id identifier id'>leaf_id</span><span class='bitor op'>|</span>
    <span class='leaf identifier id'>leaf</span> <span class='assign token'>=</span> <span class='LoopItem constant id'>LoopItem</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='leaf_id identifier id'>leaf_id</span><span class='rparen token'>)</span>
    <span class='loop_items_to_destroy identifier id'>loop_items_to_destroy</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='if if kw'>if</span> <span class='leaf identifier id'>leaf</span>
      <span class='loop_items_to_destroy identifier id'>loop_items_to_destroy</span> <span class='lshft op'>&lt;&lt;</span> <span class='leaf identifier id'>leaf</span>
      <span class='comment val'>#delete only items that do not have other descendants</span>
      <span class='leaf identifier id'>leaf</span><span class='dot token'>.</span><span class='ancestors identifier id'>ancestors</span><span class='dot token'>.</span><span class='reverse identifier id'>reverse</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='ancestor identifier id'>ancestor</span><span class='bitor op'>|</span>
        <span class='if if kw'>if</span> <span class='ancestor identifier id'>ancestor</span><span class='dot token'>.</span><span class='descendants identifier id'>descendants</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='leq op'>&lt;=</span> <span class='integer val'>1</span>
          <span class='loop_items_to_destroy identifier id'>loop_items_to_destroy</span> <span class='lshft op'>&lt;&lt;</span> <span class='ancestor identifier id'>ancestor</span>
        <span class='else else kw'>else</span>
          <span class='break break kw'>break</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
      <span class='loop_items_to_destroy identifier id'>loop_items_to_destroy</span><span class='dot token'>.</span><span class='sort identifier id'>sort</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='a identifier id'>a</span><span class='comma token'>,</span><span class='b identifier id'>b</span><span class='bitor op'>|</span> <span class='b identifier id'>b</span><span class='dot token'>.</span><span class='lft identifier id'>lft</span> <span class='cmp op'>&lt;=&gt;</span> <span class='a identifier id'>a</span><span class='dot token'>.</span><span class='lft identifier id'>lft</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='item identifier id'>item</span><span class='bitor op'>|</span>
        <span class='item identifier id'>item</span><span class='dot token'>.</span><span class='destroy identifier id'>destroy</span>
        <span class='if if kw'>if</span> <span class='item identifier id'>item</span><span class='dot token'>.</span><span class='loop_item_name identifier id'>loop_item_name</span><span class='dot token'>.</span><span class='loop_items identifier id'>loop_items</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='leq op'>&lt;=</span> <span class='integer val'>1</span>
          <span class='item identifier id'>item</span><span class='dot token'>.</span><span class='loop_item_name identifier id'>loop_item_name</span><span class='dot token'>.</span><span class='destroy identifier id'>destroy</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="fill_jqgrid-instance_method">
  
    - (<tt>Object</tt>) <strong>fill_jqgrid</strong>(grid_details, params) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/loop_source.rb', line 236</span>

<span class='def def kw'>def</span> <span class='fill_jqgrid identifier id'>fill_jqgrid</span> <span class='grid_details identifier id'>grid_details</span><span class='comma token'>,</span> <span class='params identifier id'>params</span>
  <span class='grid_details identifier id'>grid_details</span><span class='lbrack token'>[</span><span class='symbol val'>:rows</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='if if kw'>if</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:sord</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='present? fid id'>present?</span> <span class='andop op'>&amp;&amp;</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:sidx</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='present? fid id'>present?</span>
    <span class='sorting_type identifier id'>sorting_type</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='loop_item_type identifier id'>loop_item_type</span><span class='dot token'>.</span><span class='self_and_descendants identifier id'>self_and_descendants</span><span class='dot token'>.</span><span class='find_by_name identifier id'>find_by_name</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:sidx</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='the_items identifier id'>the_items</span> <span class='assign token'>=</span> <span class='sorting_type identifier id'>sorting_type</span><span class='dot token'>.</span><span class='leaf_loop_items_sorted identifier id'>leaf_loop_items_sorted</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='the_items identifier id'>the_items</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='loop_item_type identifier id'>loop_item_type</span><span class='dot token'>.</span><span class='leaf? fid id'>leaf?</span> <span class='integer val'>? </span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='loop_item_type identifier id'>loop_item_type</span><span class='dot token'>.</span><span class='loop_items identifier id'>loop_items</span> <span class='colon op'>:</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='loop_item_type identifier id'>loop_item_type</span><span class='dot token'>.</span><span class='leaves identifier id'>leaves</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='a identifier id'>a</span><span class='bitor op'>|</span> <span class='a identifier id'>a</span><span class='dot token'>.</span><span class='loop_items identifier id'>loop_items</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span>
  <span class='end end kw'>end</span>
  <span class='grid_details identifier id'>grid_details</span><span class='lbrack token'>[</span><span class='symbol val'>:total_records</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='the_items identifier id'>the_items</span><span class='dot token'>.</span><span class='size identifier id'>size</span>
  <span class='first_index identifier id'>first_index</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:page</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span><span class='minus op'>-</span><span class='float val'>1.0</span><span class='rparen token'>)</span><span class='mult op'>*</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:rows</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='ceil identifier id'>ceil</span>
  <span class='last_index identifier id'>last_index</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:rows</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span> <span class='mult op'>*</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:page</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='ceil identifier id'>ceil</span>
  <span class='cells identifier id'>cells</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='the_items identifier id'>the_items</span><span class='lbrack token'>[</span><span class='first_index identifier id'>first_index</span><span class='comma token'>,</span> <span class='last_index identifier id'>last_index</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='loop_item identifier id'>loop_item</span><span class='bitor op'>|</span>
    <span class='cells identifier id'>cells</span> <span class='lshft op'>&lt;&lt;</span> <span class='loop_item identifier id'>loop_item</span><span class='dot token'>.</span><span class='fill_jqgrid identifier id'>fill_jqgrid</span>
  <span class='end end kw'>end</span>
  <span class='if if kw'>if</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:_search</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>&quot;true&quot;</span>
    <span class='search_level identifier id'>search_level</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='loop_item_type identifier id'>loop_item_type</span><span class='dot token'>.</span><span class='self_and_descendants identifier id'>self_and_descendants</span><span class='dot token'>.</span><span class='find_by_name identifier id'>find_by_name</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:searchField</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='level identifier id'>level</span>
    <span class='cells identifier id'>cells</span> <span class='assign token'>=</span> <span class='LoopSource constant id'>LoopSource</span><span class='dot token'>.</span><span class='parse_search identifier id'>parse_search</span><span class='lparen token'>(</span><span class='cells identifier id'>cells</span><span class='comma token'>,</span> <span class='search_level identifier id'>search_level</span><span class='plus op'>+</span><span class='integer val'>1</span><span class='comma token'>,</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:searchString</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:searchOper</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:language</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='cells identifier id'>cells</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='cell identifier id'>cell</span><span class='bitor op'>|</span>
    <span class='grid_details identifier id'>grid_details</span><span class='lbrack token'>[</span><span class='symbol val'>:rows</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrace token'>{</span> <span class='symbol val'>:cell</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='cell identifier id'>cell</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='a identifier id'>a</span><span class='bitor op'>|</span> <span class='lparen token'>(</span><span class='a identifier id'>a</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='LoopItem constant id'>LoopItem</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='a identifier id'>a</span><span class='dot token'>.</span><span class='item_name identifier id'>item_name</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:language</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='colon op'>:</span> <span class='a identifier id'>a</span><span class='rparen token'>)</span><span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>
  <span class='grid_details identifier id'>grid_details</span><span class='lbrack token'>[</span><span class='symbol val'>:total_pages</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='grid_details identifier id'>grid_details</span><span class='lbrack token'>[</span><span class='symbol val'>:total_records</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span><span class='div op'>/</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:rows</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='ceil identifier id'>ceil</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="matching_structure?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>matching_structure?</strong>(status, item_types) 
  

  
</p><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


154
155
156
157
158
159
160
161
162
163
164
165</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/loop_source.rb', line 154</span>

<span class='def def kw'>def</span> <span class='matching_structure? fid id'>matching_structure?</span><span class='lparen token'>(</span><span class='status identifier id'>status</span><span class='comma token'>,</span> <span class='item_types identifier id'>item_types</span><span class='rparen token'>)</span>
  <span class='comment val'>#remove the '#' character, since it is no longer needed</span>
  <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:headers</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='slice! fid id'>slice!</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='rparen token'>)</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='loop_item_type identifier id'>loop_item_type</span><span class='dot token'>.</span><span class='self_and_descendants identifier id'>self_and_descendants</span><span class='dot token'>.</span><span class='sort identifier id'>sort</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='descendant identifier id'>descendant</span><span class='bitor op'>|</span>
    <span class='if if kw'>if</span> <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:headers</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='descendant identifier id'>descendant</span><span class='dot token'>.</span><span class='level identifier id'>level</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span> <span class='neq op'>!=</span> <span class='descendant identifier id'>descendant</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span>
      <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:errors</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;Header row does not match the existing structure of this loop source. Mismatch: #{status[:headers][descendant.level]} != descendant.name&quot;</span>
      <span class='return return kw'>return</span> <span class='false false kw'>false</span>
    <span class='end end kw'>end</span>
    <span class='item_types identifier id'>item_types</span><span class='dot token'>.</span><span class='merge! fid id'>merge!</span><span class='lparen token'>(</span><span class='descendant identifier id'>descendant</span><span class='dot token'>.</span><span class='name identifier id'>name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='descendant identifier id'>descendant</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='true true kw'>true</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="parse_file-instance_method">
  
    - (<tt>Object</tt>) <strong>parse_file</strong>(status, source_file_obj) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
load the loop_items of a oop_source from a file.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/loop_source.rb', line 54</span>

<span class='def def kw'>def</span> <span class='parse_file identifier id'>parse_file</span> <span class='status identifier id'>status</span><span class='comma token'>,</span> <span class='source_file_obj identifier id'>source_file_obj</span>
  <span class='existing_structure identifier id'>existing_structure</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='loop_item_type identifier id'>loop_item_type</span><span class='dot token'>.</span><span class='present? fid id'>present?</span>
  <span class='comment val'>#keep track of the errors</span>
  <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:errors</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='comment val'>#keep track of the line and column being analised, for error reporting.</span>
  <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:line</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:column</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='comment val'>#save the headers and the items</span>
  <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:headers</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:items</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='comment val'>#auxiliar hash, to avoid repetition</span>
  <span class='created_items identifier id'>created_items</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='comment val'>#read the file into a table</span>
  <span class='begin begin kw'>begin</span>
    <span class='table identifier id'>table</span> <span class='assign token'>=</span> <span class='FasterCSV constant id'>FasterCSV</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='source_file_obj identifier id'>source_file_obj</span><span class='dot token'>.</span><span class='source identifier id'>source</span><span class='dot token'>.</span><span class='path identifier id'>path</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='symbol val'>:quote_char</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'&quot;'</span><span class='comma token'>,</span> <span class='symbol val'>:col_sep</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='string val'>','</span><span class='comma token'>,</span> <span class='symbol val'>:row_sep</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:auto</span><span class='comma token'>,</span> <span class='symbol val'>:headers</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:first_row</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='rescue rescue kw'>rescue</span> <span class='Exception constant id'>Exception</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
    <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:errors</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='e identifier id'>e</span><span class='dot token'>.</span><span class='message identifier id'>message</span>
    <span class='return return kw'>return</span> <span class='false false kw'>false</span>
  <span class='end end kw'>end</span>
  <span class='comment val'>#get the headers</span>
  <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:headers</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='table identifier id'>table</span><span class='dot token'>.</span><span class='headers identifier id'>headers</span><span class='dot token'>.</span><span class='to_a identifier id'>to_a</span>
  <span class='item_types identifier id'>item_types</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='parse_source_headers identifier id'>parse_source_headers</span><span class='lparen token'>(</span><span class='status identifier id'>status</span><span class='comma token'>,</span> <span class='item_types identifier id'>item_types</span><span class='comma token'>,</span> <span class='existing_structure identifier id'>existing_structure</span><span class='rparen token'>)</span>
    <span class='return return kw'>return</span> <span class='false false kw'>false</span>
  <span class='end end kw'>end</span>

  <span class='default_language identifier id'>default_language</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='questionnaire identifier id'>questionnaire</span><span class='dot token'>.</span><span class='questionnaire_fields identifier id'>questionnaire_fields</span><span class='dot token'>.</span><span class='find_by_is_default_language identifier id'>find_by_is_default_language</span><span class='lparen token'>(</span><span class='true true kw'>true</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='language identifier id'>language</span>

  <span class='comment val'>#go through each row</span>
  <span class='table identifier id'>table</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='row identifier id'>row</span><span class='bitor op'>|</span>
    <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:line</span><span class='rbrack token'>]</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
    <span class='comment val'>#Start with parent as nil (because the first element of each line is the root of the nested set, and looping structure)</span>
    <span class='comment val'>#there is also an hierarchy between items.</span>
    <span class='parent identifier id'>parent</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
    <span class='comment val'>#and then for each item of the row</span>
    <span class='row_as_a identifier id'>row_as_a</span> <span class='assign token'>=</span> <span class='row identifier id'>row</span><span class='dot token'>.</span><span class='to_a identifier id'>to_a</span>
    <span class='row_as_a identifier id'>row_as_a</span><span class='dot token'>.</span><span class='each_index identifier id'>each_index</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='i identifier id'>i</span><span class='bitor op'>|</span> <span class='comment val'>#row_as_a[i][0] =&gt; item_type ; row_as_a[i][1] =&gt; loop_item_names</span>
      <span class='created_items identifier id'>created_items</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
      <span class='if if kw'>if</span> <span class='row_as_a identifier id'>row_as_a</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='present? fid id'>present?</span> <span class='comment val'>#if there's no name, there's no item</span>
        <span class='the_val identifier id'>the_val</span> <span class='assign token'>=</span> <span class='row_as_a identifier id'>row_as_a</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span>
        <span class='the_type identifier id'>the_type</span> <span class='assign token'>=</span> <span class='row_as_a identifier id'>row_as_a</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span>
        <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:column</span><span class='rbrack token'>]</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
        <span class='if if kw'>if</span> <span class='existing_structure identifier id'>existing_structure</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='existing_item identifier id'>existing_item</span><span class='assign token'>=</span><span class='lparen token'>(</span><span class='item_types identifier id'>item_types</span><span class='lbrack token'>[</span><span class='the_type identifier id'>the_type</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='existing_item_with identifier id'>existing_item_with</span><span class='lparen token'>(</span><span class='the_val identifier id'>the_val</span><span class='comma token'>,</span> <span class='parent identifier id'>parent</span><span class='comma token'>,</span> <span class='default_language identifier id'>default_language</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
          <span class='parent identifier id'>parent</span> <span class='assign token'>=</span> <span class='existing_item identifier id'>existing_item</span>
          <span class='next next kw'>next</span>
        <span class='end end kw'>end</span>
        <span class='comment val'>#loop_item_names in downcase for comparison purposes. So that the file doesn't need to be case sensitive.</span>
        <span class='item_details identifier id'>item_details</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='symbol val'>:name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='the_val identifier id'>the_val</span><span class='dot token'>.</span><span class='downcase identifier id'>downcase</span><span class='comma token'>,</span> <span class='symbol val'>:parent</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='parent identifier id'>parent</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='integer val'>? </span><span class='string val'>&quot;parent_empty&quot;</span> <span class='colon op'>:</span> <span class='parent identifier id'>parent</span><span class='dot token'>.</span><span class='id identifier id'>id</span> <span class='rbrace token'>}</span>
        <span class='item_hash identifier id'>item_hash</span> <span class='assign token'>=</span> <span class='Digest constant id'>Digest</span><span class='colon2 op'>::</span><span class='MD5 constant id'>MD5</span><span class='dot token'>.</span><span class='hexdigest identifier id'>hexdigest</span><span class='lparen token'>(</span><span class='item_details identifier id'>item_details</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span>
        <span class='comment val'>#check if item was previously added</span>
        <span class='if if kw'>if</span> <span class='created_items identifier id'>created_items</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='item_hash identifier id'>item_hash</span><span class='rbrack token'>]</span>
          <span class='comment val'>#set this item as the parent</span>
          <span class='parent identifier id'>parent</span> <span class='assign token'>=</span> <span class='LoopItem constant id'>LoopItem</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='created_items identifier id'>created_items</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='item_hash identifier id'>item_hash</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
        <span class='else else kw'>else</span> <span class='comment val'>#otherwise create a new item</span>
          <span class='son identifier id'>son</span> <span class='assign token'>=</span> <span class='LoopItem constant id'>LoopItem</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='rparen token'>)</span><span class='comment val'>#:item_name =&gt; row_as_a[i][1].to_s)</span>
          <span class='comment val'>#set it's parent, if parent is defined, otherwise it will be a root item.</span>
          <span class='if if kw'>if</span> <span class='parent identifier id'>parent</span>
            <span class='son identifier id'>son</span><span class='dot token'>.</span><span class='parent identifier id'>parent</span> <span class='assign token'>=</span> <span class='parent identifier id'>parent</span>
          <span class='end end kw'>end</span>
          <span class='comment val'>#handle loopItemNames. Find or create it and then add it to the loop_item and loop_item_type and loop_source</span>
          <span class='l_item_name identifier id'>l_item_name</span> <span class='assign token'>=</span> <span class='item_types identifier id'>item_types</span><span class='lbrack token'>[</span><span class='the_type identifier id'>the_type</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='loop_item_name_with identifier id'>loop_item_name_with</span><span class='lparen token'>(</span><span class='the_val identifier id'>the_val</span><span class='comma token'>,</span> <span class='default_language identifier id'>default_language</span><span class='rparen token'>)</span>
          <span class='son identifier id'>son</span><span class='dot token'>.</span><span class='loop_item_name identifier id'>loop_item_name</span> <span class='assign token'>=</span> <span class='l_item_name identifier id'>l_item_name</span>
          <span class='comment val'>#create the relation between the loop_item_names and the loop_item_type as well as the loop_source.</span>
          <span class='item_types identifier id'>item_types</span><span class='lbrack token'>[</span><span class='the_type identifier id'>the_type</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='loop_item_names identifier id'>loop_item_names</span> <span class='lshft op'>&lt;&lt;</span> <span class='l_item_name identifier id'>l_item_name</span> <span class='unless unless_mod kw'>unless</span> <span class='item_types identifier id'>item_types</span><span class='lbrack token'>[</span><span class='the_type identifier id'>the_type</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='loop_item_names identifier id'>loop_item_names</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='l_item_name identifier id'>l_item_name</span><span class='rparen token'>)</span>
          <span class='self self kw'>self</span><span class='dot token'>.</span><span class='loop_item_names identifier id'>loop_item_names</span> <span class='lshft op'>&lt;&lt;</span> <span class='l_item_name identifier id'>l_item_name</span> <span class='unless unless_mod kw'>unless</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='loop_item_names identifier id'>loop_item_names</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='l_item_name identifier id'>l_item_name</span><span class='rparen token'>)</span>
          <span class='comment val'>#set sort_index =&gt; total loop_items before adding the new item to it, so that it is the index of the total of items[0 to total]</span>
          <span class='comment val'>#son.sort_index = item_types[the_type].loop_items.count #set the sort_index to be one more than the parent's. The default is zero, so the parent starts at zero.</span>
          <span class='son identifier id'>son</span><span class='dot token'>.</span><span class='sort_index identifier id'>sort_index</span> <span class='assign token'>=</span> <span class='item_types identifier id'>item_types</span><span class='lbrack token'>[</span><span class='the_type identifier id'>the_type</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='loop_items identifier id'>loop_items</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> <span class='integer val'>? </span><span class='integer val'>0</span> <span class='colon op'>:</span> <span class='item_types identifier id'>item_types</span><span class='lbrack token'>[</span><span class='the_type identifier id'>the_type</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='loop_items identifier id'>loop_items</span><span class='dot token'>.</span><span class='maximum identifier id'>maximum</span><span class='lparen token'>(</span><span class='string val'>&quot;sort_index&quot;</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='integer val'>1</span>
          <span class='comment val'>#save the son</span>
          <span class='if if kw'>if</span> <span class='son identifier id'>son</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
            <span class='comment val'>#add loop item, to the proper LoopItemType object</span>
            <span class='item_types identifier id'>item_types</span><span class='lbrack token'>[</span><span class='the_type identifier id'>the_type</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='loop_items identifier id'>loop_items</span> <span class='lshft op'>&lt;&lt;</span> <span class='son identifier id'>son</span>
            <span class='comment val'>#add the item to the hash of created items</span>
            <span class='created_items identifier id'>created_items</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='item_hash identifier id'>item_hash</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='son identifier id'>son</span><span class='dot token'>.</span><span class='id identifier id'>id</span>
            <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:items</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='son identifier id'>son</span>
            <span class='comment val'>#redefine the parent for next iteration</span>
            <span class='parent identifier id'>parent</span> <span class='assign token'>=</span> <span class='son identifier id'>son</span>
          <span class='else else kw'>else</span>
            <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:errors</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;Problem in line &quot;</span> <span class='plus op'>+</span> <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:line</span><span class='rbrack token'>]</span> <span class='plus op'>+</span> <span class='string val'>&quot;, and column &quot;</span> <span class='plus op'>+</span> <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:column</span><span class='rbrack token'>]</span>
            <span class='return return kw'>return</span> <span class='false false kw'>false</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:column</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="parse_loop_source_files-instance_method">
  
    - (<tt>Object</tt>) <strong>parse_loop_source_files</strong>(user_id, user_ip) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/loop_source.rb', line 33</span>

<span class='def def kw'>def</span> <span class='parse_loop_source_files identifier id'>parse_loop_source_files</span><span class='lparen token'>(</span><span class='user_id identifier id'>user_id</span><span class='comma token'>,</span> <span class='user_ip identifier id'>user_ip</span><span class='rparen token'>)</span>
  <span class='status identifier id'>status</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='sources identifier id'>sources</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='source_files identifier id'>source_files</span><span class='dot token'>.</span><span class='find_all_by_parse_status identifier id'>find_all_by_parse_status</span><span class='lparen token'>(</span><span class='ParseFileStatus constant id'>ParseFileStatus</span><span class='colon2 op'>::</span><span class='TO_PARSE constant id'>TO_PARSE</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='sources identifier id'>sources</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='source_file_obj identifier id'>source_file_obj</span><span class='bitor op'>|</span>
    <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='parse_file identifier id'>parse_file</span> <span class='status identifier id'>status</span><span class='comma token'>,</span> <span class='source_file_obj identifier id'>source_file_obj</span>
      <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:errors</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='error identifier id'>error</span><span class='bitor op'>|</span>
        <span class='source_file_obj identifier id'>source_file_obj</span><span class='dot token'>.</span><span class='persistent_errors identifier id'>persistent_errors</span> <span class='lshft op'>&lt;&lt;</span> <span class='PersistentError constant id'>PersistentError</span><span class='dot token'>.</span><span class='create identifier id'>create</span><span class='lparen token'>(</span><span class='symbol val'>:details</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='error identifier id'>error</span><span class='comma token'>,</span> <span class='symbol val'>:user_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='user_id identifier id'>user_id</span><span class='comma token'>,</span> <span class='symbol val'>:user_ip</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='user_ip identifier id'>user_ip</span><span class='comma token'>,</span> <span class='symbol val'>:timestamp</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='DateTime constant id'>DateTime</span><span class='dot token'>.</span><span class='now identifier id'>now</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
      <span class='source_file_obj identifier id'>source_file_obj</span><span class='dot token'>.</span><span class='parse_status identifier id'>parse_status</span> <span class='assign token'>=</span> <span class='ParseFileStatus constant id'>ParseFileStatus</span><span class='colon2 op'>::</span><span class='ERROR_FINISH constant id'>ERROR_FINISH</span>
    <span class='else else kw'>else</span>
      <span class='source_file_obj identifier id'>source_file_obj</span><span class='dot token'>.</span><span class='parse_status identifier id'>parse_status</span> <span class='assign token'>=</span> <span class='ParseFileStatus constant id'>ParseFileStatus</span><span class='colon2 op'>::</span><span class='FINISHED constant id'>FINISHED</span>
      <span class='source_file_obj identifier id'>source_file_obj</span><span class='dot token'>.</span><span class='persistent_errors identifier id'>persistent_errors</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='error identifier id'>error</span><span class='bitor op'>|</span>
        <span class='error identifier id'>error</span><span class='dot token'>.</span><span class='destroy identifier id'>destroy</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='source_file_obj identifier id'>source_file_obj</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="parse_source_headers-instance_method">
  
    - (<tt>Object</tt>) <strong>parse_source_headers</strong>(status, item_types, existing_structure) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


142
143
144
145
146
147
148
149
150
151
152</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/loop_source.rb', line 142</span>

<span class='def def kw'>def</span> <span class='parse_source_headers identifier id'>parse_source_headers</span> <span class='status identifier id'>status</span><span class='comma token'>,</span> <span class='item_types identifier id'>item_types</span><span class='comma token'>,</span> <span class='existing_structure identifier id'>existing_structure</span>
  <span class='comment val'>#check if headers are present: Headers/Title line should start with &quot;#&quot;</span>
  <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='lbrack token'>[</span><span class='string val'>'#'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:headers</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='comma token'>,</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:errors</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;Header row is not properly defined. Should start with a '#' character.&quot;</span>
    <span class='return return kw'>return</span> <span class='false false kw'>false</span>
  <span class='elsif elsif kw'>elsif</span> <span class='notop op'>!</span><span class='existing_structure identifier id'>existing_structure</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='create_new_structure identifier id'>create_new_structure</span><span class='lparen token'>(</span><span class='status identifier id'>status</span><span class='comma token'>,</span> <span class='item_types identifier id'>item_types</span> <span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='matching_structure? fid id'>matching_structure?</span><span class='lparen token'>(</span><span class='status identifier id'>status</span><span class='comma token'>,</span> <span class='item_types identifier id'>item_types</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="unparsed_sources?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>unparsed_sources?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Methods
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


29
30
31</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/loop_source.rb', line 29</span>

<span class='def def kw'>def</span> <span class='unparsed_sources? fid id'>unparsed_sources?</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='source_files identifier id'>source_files</span><span class='dot token'>.</span><span class='find_by_parse_status identifier id'>find_by_parse_status</span><span class='lparen token'>(</span><span class='ParseFileStatus constant id'>ParseFileStatus</span><span class='colon2 op'>::</span><span class='TO_PARSE constant id'>TO_PARSE</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="update_records-instance_method">
  
    - (<tt>Object</tt>) <strong>update_records</strong>(params) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


261
262
263
264
265
266
267
268
269
270</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/loop_source.rb', line 261</span>

<span class='def def kw'>def</span> <span class='update_records identifier id'>update_records</span> <span class='params identifier id'>params</span>
  <span class='default_lang identifier id'>default_lang</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='questionnaire identifier id'>questionnaire</span><span class='dot token'>.</span><span class='questionnaire_fields identifier id'>questionnaire_fields</span><span class='dot token'>.</span><span class='find_by_is_default_language identifier id'>find_by_is_default_language</span><span class='lparen token'>(</span><span class='true true kw'>true</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='language identifier id'>language</span>
  <span class='leaf_item identifier id'>leaf_item</span> <span class='assign token'>=</span> <span class='LoopItem constant id'>LoopItem</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:leaf_id</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:include</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:loop_item_name</span><span class='comma token'>,</span> <span class='symbol val'>:loop_item_type</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='lang_code identifier id'>lang_code</span> <span class='assign token'>=</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:language</span><span class='rbrack token'>]</span>
  <span class='leaf_item identifier id'>leaf_item</span><span class='dot token'>.</span><span class='self_and_ancestors identifier id'>self_and_ancestors</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='loop_item identifier id'>loop_item</span><span class='bitor op'>|</span>
    <span class='if if kw'>if</span> <span class='loop_item identifier id'>loop_item</span><span class='dot token'>.</span><span class='item_name identifier id'>item_name</span><span class='lparen token'>(</span><span class='lang_code identifier id'>lang_code</span><span class='rparen token'>)</span> <span class='neq op'>!=</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='loop_item identifier id'>loop_item</span><span class='dot token'>.</span><span class='loop_item_type identifier id'>loop_item_type</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span><span class='rbrack token'>]</span>
      <span class='loop_item identifier id'>loop_item</span><span class='dot token'>.</span><span class='update_name_from identifier id'>update_name_from</span> <span class='params identifier id'>params</span><span class='comma token'>,</span> <span class='lang_code identifier id'>lang_code</span><span class='comma token'>,</span> <span class='default_lang identifier id'>default_lang</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="update_sections-instance_method">
  
    - (<tt>Object</tt>) <strong>update_sections</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


227
228
229
230
231
232
233</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/loop_source.rb', line 227</span>

<span class='def def kw'>def</span> <span class='update_sections identifier id'>update_sections</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='sections identifier id'>sections</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='section identifier id'>section</span><span class='bitor op'>|</span>
    <span class='section identifier id'>section</span><span class='dot token'>.</span><span class='section_type identifier id'>section_type</span> <span class='assign token'>=</span> <span class='SectionType constant id'>SectionType</span><span class='colon2 op'>::</span><span class='REGULAR constant id'>REGULAR</span>
    <span class='section identifier id'>section</span><span class='dot token'>.</span><span class='loop_source identifier id'>loop_source</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
    <span class='section identifier id'>section</span><span class='dot token'>.</span><span class='save! fid id'>save!</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Fri Jul  8 14:33:30 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.2 (ruby-1.8.7).
</div>

  </body>
</html>