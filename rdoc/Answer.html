<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Answer
  
    &mdash; Documentation by YARD 0.7.2
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (A)</a> &raquo; 
    
    
    <span class="title">Answer</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Answer
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">ActiveRecord::Base</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActiveRecord::Base</li>
          
            <li class="next">Answer</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">app/models/answer.rb</dd>
  
</dl>
<div class="clear"></div>



  


  

  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_or_create_new_answer-class_method" title="find_or_create_new_answer (class method)">+ (Object) <strong>find_or_create_new_answer</strong>(question, user, questionnaire, from_dependent_section, loop_item_id = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#save_answers-class_method" title="save_answers (class method)">+ (Object) <strong>save_answers</strong>(questionnaire, user, user_answers, dependent_sections_state) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
TODO:
</p>
<ul>
<li>Save Rank Answers - Done

</li>
<li>Save Range Answers - Done

</li>
<li>Save Matrix Answers - Done

</li>
<li>Handle multi answers details text - Done

</li>
<li>Handle other text - Done

</li>
<li>Check the result of the save - Done

</li>
<li>Check the state of the Root Section - Done

</li>
<li>Remove answers from dependent sections that become hidden

</li>
<li>Check that Multi Answers details text&#8217;s get erased if the option is
not selected .

</li>
</ul>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#validate_the_urls-class_method" title="validate_the_urls (class method)">+ (Object) <strong>validate_the_urls</strong>(params) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clone_answer_details-instance_method" title="#clone_answer_details (instance method)">- (Object) <strong>clone_answer_details</strong>(questions_link, options_link, text_fields_link, numeric_answers_link, loop_items_link) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Methods.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_text_answer_field_if_it_exists-instance_method" title="#get_text_answer_field_if_it_exists (instance method)">- (Object) <strong>get_text_answer_field_if_it_exists</strong>(text_answer_field, translator_visible) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
for text_answer type answers.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#matrix_cells_answers-instance_method" title="#matrix_cells_answers (instance method)">- (Object) <strong>matrix_cells_answers</strong>(selection) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  

  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="find_or_create_new_answer-class_method">
  
    + (<tt>Object</tt>) <strong>find_or_create_new_answer</strong>(question, user, questionnaire, from_dependent_section, loop_item_id = nil) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


99
100
101
102
103
104
105</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/answer.rb', line 99</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='find_or_create_new_answer identifier id'>find_or_create_new_answer</span><span class='lparen token'>(</span><span class='question identifier id'>question</span><span class='comma token'>,</span> <span class='user identifier id'>user</span><span class='comma token'>,</span> <span class='questionnaire identifier id'>questionnaire</span><span class='comma token'>,</span> <span class='from_dependent_section identifier id'>from_dependent_section</span><span class='comma token'>,</span> <span class='loop_item_id identifier id'>loop_item_id</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='loop_item_id identifier id'>loop_item_id</span><span class='dot token'>.</span><span class='present? fid id'>present?</span>
    <span class='Answer constant id'>Answer</span><span class='dot token'>.</span><span class='find_or_create_by_question_id_and_user_id_and_questionnaire_id_and_loop_item_id_and_from_dependent_section identifier id'>find_or_create_by_question_id_and_user_id_and_questionnaire_id_and_loop_item_id_and_from_dependent_section</span><span class='lparen token'>(</span><span class='question identifier id'>question</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='user identifier id'>user</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='questionnaire identifier id'>questionnaire</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='loop_item_id identifier id'>loop_item_id</span><span class='comma token'>,</span> <span class='from_dependent_section identifier id'>from_dependent_section</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='Answer constant id'>Answer</span><span class='dot token'>.</span><span class='find_or_create_by_question_id_and_user_id_and_questionnaire_id_and_from_dependent_section identifier id'>find_or_create_by_question_id_and_user_id_and_questionnaire_id_and_from_dependent_section</span><span class='lparen token'>(</span><span class='question identifier id'>question</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='user identifier id'>user</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='questionnaire identifier id'>questionnaire</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='from_dependent_section identifier id'>from_dependent_section</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="save_answers-class_method">
  
    + (<tt>Object</tt>) <strong>save_answers</strong>(questionnaire, user, user_answers, dependent_sections_state) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
TODO:
</p>
<ul>
<li>Save Rank Answers - Done

</li>
<li>Save Range Answers - Done

</li>
<li>Save Matrix Answers - Done

</li>
<li>Handle multi answers details text - Done

</li>
<li>Handle other text - Done

</li>
<li>Check the result of the save - Done

</li>
<li>Check the state of the Root Section - Done

</li>
<li>Remove answers from dependent sections that become hidden

</li>
<li>Check that Multi Answers details text&#8217;s get erased if the option is
not selected

</li>
</ul>
<p>
Method to save the input of the user in the questionnaire as answers.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>questionnaire</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Questionnaire.html" title="Questionnaire (class)">Questionnaire</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Questionnaire being replied by the user
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>user</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="User.html" title="User (class)">User</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
User whose answers are being saved
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>user_answers</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Hash with the answers of the user. The key is a string that contains the
question_id, the loop_item_id (or zero), and some more information
depending on the type of answer. The value is the user actual answer.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>dependent_sections_state</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Hash with the state of the dependent sections of the questionnaire. (
=&gt; hidden or not (1- hidden; 0- visible)
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/answer.rb', line 124</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='save_answers identifier id'>save_answers</span> <span class='questionnaire identifier id'>questionnaire</span><span class='comma token'>,</span> <span class='user identifier id'>user</span><span class='comma token'>,</span> <span class='user_answers identifier id'>user_answers</span><span class='comma token'>,</span> <span class='dependent_sections_state identifier id'>dependent_sections_state</span>
  <span class='answers identifier id'>answers</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='parts_to_save identifier id'>parts_to_save</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='to_remove identifier id'>to_remove</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='user_answers identifier id'>user_answers</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='identifiers identifier id'>identifiers</span><span class='comma token'>,</span> <span class='val identifier id'>val</span><span class='bitor op'>|</span>
    <span class='question_id identifier id'>question_id</span><span class='comma token'>,</span> <span class='loop_item_id identifier id'>loop_item_id</span><span class='comma token'>,</span> <span class='field_id identifier id'>field_id</span><span class='comma token'>,</span> <span class='extra_val identifier id'>extra_val</span> <span class='assign token'>=</span> <span class='identifiers identifier id'>identifiers</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;_&quot;</span><span class='rparen token'>)</span>
    <span class='loop_item_id identifier id'>loop_item_id</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='loop_item_id identifier id'>loop_item_id</span> <span class='eq op'>==</span> <span class='string val'>&quot;0&quot;</span>
    <span class='question identifier id'>question</span> <span class='assign token'>=</span> <span class='Question constant id'>Question</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='question_id identifier id'>question_id</span><span class='rparen token'>)</span>
    <span class='from_dependent_section identifier id'>from_dependent_section</span><span class='comma token'>,</span> <span class='dependent_section identifier id'>dependent_section</span> <span class='assign token'>=</span> <span class='question identifier id'>question</span><span class='dot token'>.</span><span class='nested_under_dependent_section? fid id'>nested_under_dependent_section?</span>
    <span class='comment val'>#If the question is nested under a dependent section, one needs to check if there were changes with the availability of a dependent section. That is defined inside the 'dependent_sections_state' hash.</span>
    <span class='comment val'>#If the dependent_section is hidden this method hads it to an array of dependent_sections_to_hide that will be used to set those sections submission state to be marked as 'dont_care' (for the overall state of the section tree)</span>
    <span class='comment val'>#The dependent_section answer parts will be destroyed #TODO: update the page to reflect this deletion?</span>
    <span class='if if kw'>if</span> <span class='from_dependent_section identifier id'>from_dependent_section</span> <span class='andop op'>&amp;&amp;</span> <span class='dependent_section identifier id'>dependent_section</span> <span class='andop op'>&amp;&amp;</span> <span class='dependent_sections_state identifier id'>dependent_sections_state</span> <span class='andop op'>&amp;&amp;</span> <span class='dependent_sections_state identifier id'>dependent_sections_state</span><span class='lbrack token'>[</span><span class='dstring node'>&quot;#{dependent_section}_#{loop_item_id||&quot;0&quot;}&quot;</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>&quot;1&quot;</span>
      <span class='if if kw'>if</span> <span class='loop_item_id identifier id'>loop_item_id</span>
        <span class='answer identifier id'>answer</span> <span class='assign token'>=</span> <span class='Answer constant id'>Answer</span><span class='dot token'>.</span><span class='find_by_question_id_and_user_id_and_questionnair_id_and_loop_item_id_and_from_dependent_section identifier id'>find_by_question_id_and_user_id_and_questionnair_id_and_loop_item_id_and_from_dependent_section</span><span class='lparen token'>(</span><span class='question identifier id'>question</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='user identifier id'>user</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='questionnaire identifier id'>questionnaire</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='loop_item_id identifier id'>loop_item_id</span><span class='comma token'>,</span> <span class='from_dependent_section identifier id'>from_dependent_section</span><span class='rparen token'>)</span>
      <span class='else else kw'>else</span>
        <span class='answer identifier id'>answer</span> <span class='assign token'>=</span> <span class='Answer constant id'>Answer</span><span class='dot token'>.</span><span class='find_by_question_id_and_user_id_and_questionnair_id_and_from_dependent_section identifier id'>find_by_question_id_and_user_id_and_questionnair_id_and_from_dependent_section</span><span class='lparen token'>(</span><span class='question identifier id'>question</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='user identifier id'>user</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='questionnaire identifier id'>questionnaire</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='from_dependent_section identifier id'>from_dependent_section</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
      <span class='if if kw'>if</span> <span class='answer identifier id'>answer</span>
        <span class='answers identifier id'>answers</span> <span class='lshft op'>&lt;&lt;</span> <span class='answer identifier id'>answer</span> <span class='if if_mod kw'>if</span> <span class='notop op'>!</span><span class='answers identifier id'>answers</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='answer identifier id'>answer</span><span class='rparen token'>)</span>
        <span class='if if kw'>if</span> <span class='question identifier id'>question</span><span class='dot token'>.</span><span class='answer_type_type identifier id'>answer_type_type</span> <span class='eq op'>==</span> <span class='string val'>&quot;MatrixAnswer&quot;</span>
          <span class='to_remove identifier id'>to_remove</span> <span class='opasgn op'>+=</span> <span class='answer identifier id'>answer</span><span class='dot token'>.</span><span class='answer_parts identifier id'>answer_parts</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='symbol val'>:answer_part_matrix_options</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span>
        <span class='else else kw'>else</span>
          <span class='to_remove identifier id'>to_remove</span> <span class='opasgn op'>+=</span> <span class='answer identifier id'>answer</span><span class='dot token'>.</span><span class='answer_parts identifier id'>answer_parts</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
      <span class='next next kw'>next</span> <span class='comment val'>#move to the next answer</span>
    <span class='end end kw'>end</span>
    <span class='answer identifier id'>answer</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='find_or_create_new_answer identifier id'>find_or_create_new_answer</span><span class='lparen token'>(</span><span class='question identifier id'>question</span><span class='comma token'>,</span> <span class='user identifier id'>user</span><span class='comma token'>,</span> <span class='questionnaire identifier id'>questionnaire</span><span class='comma token'>,</span> <span class='from_dependent_section identifier id'>from_dependent_section</span><span class='comma token'>,</span> <span class='loop_item_id identifier id'>loop_item_id</span><span class='rparen token'>)</span>
    <span class='answers identifier id'>answers</span> <span class='lshft op'>&lt;&lt;</span> <span class='answer identifier id'>answer</span> <span class='if if_mod kw'>if</span> <span class='notop op'>!</span><span class='answers identifier id'>answers</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='answer identifier id'>answer</span><span class='rparen token'>)</span>
    <span class='case case kw'>case</span> <span class='question identifier id'>question</span><span class='dot token'>.</span><span class='answer_type_type identifier id'>answer_type_type</span>
      <span class='when when kw'>when</span> <span class='string val'>&quot;TextAnswer&quot;</span>
        <span class='comment val'>#Saving Text Answers: input format of 'identifiers' =&gt; 'val'</span>
        <span class='comment val'>#Text Answer: &quot;question_id, loop_item_id, text_answer_field_id(field_id), lang[original, &quot;en&quot;](extra_val)&quot; =&gt; answer (val)</span>
        <span class='lang identifier id'>lang</span> <span class='assign token'>=</span> <span class='extra_val identifier id'>extra_val</span>
        <span class='if if kw'>if</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='present? fid id'>present?</span>
          <span class='ap identifier id'>ap</span> <span class='assign token'>=</span> <span class='answer identifier id'>answer</span><span class='dot token'>.</span><span class='answer_parts identifier id'>answer_parts</span><span class='dot token'>.</span><span class='find_by_field_type_id_and_field_type_type identifier id'>find_by_field_type_id_and_field_type_type</span><span class='lparen token'>(</span><span class='field_id identifier id'>field_id</span><span class='comma token'>,</span> <span class='string val'>&quot;TextAnswerField&quot;</span> <span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='AnswerPart constant id'>AnswerPart</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:answer_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='answer identifier id'>answer</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='symbol val'>:field_type_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='field_id identifier id'>field_id</span><span class='comma token'>,</span> <span class='symbol val'>:field_type_type</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;TextAnswerField&quot;</span><span class='rparen token'>)</span>
          <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='answer_text identifier id'>answer_text</span> <span class='assign token'>=</span> <span class='val identifier id'>val</span> <span class='if if_mod kw'>if</span> <span class='notop op'>!</span><span class='lang identifier id'>lang</span>
          <span class='if if kw'>if</span> <span class='string val'>&quot;en&quot;</span> <span class='eq op'>==</span> <span class='lang identifier id'>lang</span>
            <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='answer_text_in_english identifier id'>answer_text_in_english</span> <span class='assign token'>=</span> <span class='val identifier id'>val</span>
          <span class='elsif elsif kw'>elsif</span> <span class='string val'>&quot;original&quot;</span> <span class='eq op'>==</span> <span class='lang identifier id'>lang</span>
            <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='original_language identifier id'>original_language</span> <span class='assign token'>=</span> <span class='val identifier id'>val</span>
          <span class='end end kw'>end</span>
          <span class='parts_to_save identifier id'>parts_to_save</span> <span class='lshft op'>&lt;&lt;</span> <span class='ap identifier id'>ap</span> <span class='if if_mod kw'>if</span> <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='changed? fid id'>changed?</span>
        <span class='else else kw'>else</span>
          <span class='ap identifier id'>ap</span> <span class='assign token'>=</span> <span class='answer identifier id'>answer</span><span class='dot token'>.</span><span class='answer_parts identifier id'>answer_parts</span><span class='dot token'>.</span><span class='find_by_field_type_id_and_field_type_type identifier id'>find_by_field_type_id_and_field_type_type</span><span class='lparen token'>(</span><span class='field_id identifier id'>field_id</span><span class='comma token'>,</span> <span class='string val'>&quot;TextAnswerField&quot;</span> <span class='rparen token'>)</span>
          <span class='to_remove identifier id'>to_remove</span> <span class='lshft op'>&lt;&lt;</span> <span class='ap identifier id'>ap</span> <span class='if if_mod kw'>if</span> <span class='ap identifier id'>ap</span>
        <span class='end end kw'>end</span>
      <span class='when when kw'>when</span> <span class='string val'>&quot;NumericAnswer&quot;</span>
        <span class='comment val'>#Saving Numeric Answers: input format of 'identifiers' =&gt; 'val'</span>
        <span class='comment val'>#Numeric Answer: &quot;question_id, loop_item_id, answer_type.id (field_id)&quot; =&gt; answer(val)</span>
        <span class='if if kw'>if</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='present? fid id'>present?</span>
          <span class='ap identifier id'>ap</span> <span class='assign token'>=</span> <span class='answer identifier id'>answer</span><span class='dot token'>.</span><span class='answer_parts identifier id'>answer_parts</span><span class='dot token'>.</span><span class='find_by_field_type_id_and_field_type_type identifier id'>find_by_field_type_id_and_field_type_type</span><span class='lparen token'>(</span><span class='field_id identifier id'>field_id</span><span class='comma token'>,</span> <span class='string val'>&quot;NumericAnswer&quot;</span> <span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='AnswerPart constant id'>AnswerPart</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:answer_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='answer identifier id'>answer</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='symbol val'>:field_type_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='field_id identifier id'>field_id</span><span class='comma token'>,</span> <span class='symbol val'>:field_type_type</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;NumericAnswer&quot;</span><span class='rparen token'>)</span>
          <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='answer_text identifier id'>answer_text</span> <span class='assign token'>=</span> <span class='val identifier id'>val</span>
          <span class='parts_to_save identifier id'>parts_to_save</span> <span class='lshft op'>&lt;&lt;</span> <span class='ap identifier id'>ap</span> <span class='if if_mod kw'>if</span> <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='changed? fid id'>changed?</span>
        <span class='else else kw'>else</span>
          <span class='ap identifier id'>ap</span> <span class='assign token'>=</span> <span class='answer identifier id'>answer</span><span class='dot token'>.</span><span class='answer_parts identifier id'>answer_parts</span><span class='dot token'>.</span><span class='find_by_field_type_id_and_field_type_type identifier id'>find_by_field_type_id_and_field_type_type</span><span class='lparen token'>(</span><span class='field_id identifier id'>field_id</span><span class='comma token'>,</span> <span class='string val'>&quot;NumericAnswer&quot;</span> <span class='rparen token'>)</span>
          <span class='to_remove identifier id'>to_remove</span> <span class='lshft op'>&lt;&lt;</span> <span class='ap identifier id'>ap</span> <span class='if if_mod kw'>if</span> <span class='ap identifier id'>ap</span>
        <span class='end end kw'>end</span>
      <span class='when when kw'>when</span> <span class='string val'>&quot;MultiAnswer&quot;</span>
        <span class='comment val'>#Saving Multi Answer: input format of 'identifiers' =&gt; 'val'</span>
        <span class='comment val'>## Other Field: &quot;question_id, loop_item_id, 'other'(field_id)&quot; =&gt; &quot;val&quot;(val)</span>
        <span class='comment val'>## Details field: &quot;question_id, loop_item_id, option_id(field_id), 'details'(extra_val) =&gt; &quot;text&quot;(val)</span>
        <span class='comment val'>## Multiple Select: &quot;question_id, loop_item_id&quot; =&gt; [option1, option2](val)</span>
        <span class='comment val'>## Check-boxes: &quot;question_id, loop_item_id, option_id(field_id)&quot; =&gt; option_id || &quot;&quot; (val)</span>
        <span class='comment val'>## Radio-buttons: &quot;question_id, loop_item_id, option_id(feld_id)&quot; =&gt; option_id(val)</span>
        <span class='comment val'>## Select: &quot;question_id, loop_item_id&quot; =&gt; option_id || &quot;&quot; (val)</span>
        <span class='if if kw'>if</span> <span class='string val'>'other'</span> <span class='eq op'>==</span> <span class='field_id identifier id'>field_id</span>
          <span class='answer identifier id'>answer</span><span class='dot token'>.</span><span class='other_text identifier id'>other_text</span> <span class='assign token'>=</span> <span class='val identifier id'>val</span>
        <span class='elsif elsif kw'>elsif</span> <span class='string val'>'details'</span> <span class='eq op'>==</span> <span class='extra_val identifier id'>extra_val</span>
          <span class='ap identifier id'>ap</span> <span class='assign token'>=</span> <span class='answer identifier id'>answer</span><span class='dot token'>.</span><span class='answer_parts identifier id'>answer_parts</span><span class='dot token'>.</span><span class='find_by_field_type_id_and_field_type_type identifier id'>find_by_field_type_id_and_field_type_type</span><span class='lparen token'>(</span><span class='field_id identifier id'>field_id</span><span class='comma token'>,</span> <span class='string val'>&quot;MultiAnswerOption&quot;</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='AnswerPart constant id'>AnswerPart</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:answer_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='answer identifier id'>answer</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='symbol val'>:field_type_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='field_id identifier id'>field_id</span><span class='comma token'>,</span> <span class='symbol val'>:field_type_type</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;MultiAnswerOption&quot;</span><span class='rparen token'>)</span>
          <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='details_text identifier id'>details_text</span> <span class='assign token'>=</span> <span class='val identifier id'>val</span>
          <span class='parts_to_save identifier id'>parts_to_save</span> <span class='lshft op'>&lt;&lt;</span> <span class='ap identifier id'>ap</span> <span class='if if_mod kw'>if</span> <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='changed? fid id'>changed?</span>
        <span class='else else kw'>else</span>
          <span class='Array constant id'>Array</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='option_id identifier id'>option_id</span><span class='bitor op'>|</span>
            <span class='ap identifier id'>ap</span> <span class='assign token'>=</span> <span class='answer identifier id'>answer</span><span class='dot token'>.</span><span class='answer_parts identifier id'>answer_parts</span><span class='dot token'>.</span><span class='find_by_field_type_id_and_field_type_type identifier id'>find_by_field_type_id_and_field_type_type</span><span class='lparen token'>(</span><span class='option_id identifier id'>option_id</span><span class='comma token'>,</span> <span class='string val'>&quot;MultiAnswerOption&quot;</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='AnswerPart constant id'>AnswerPart</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:answer_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='answer identifier id'>answer</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='symbol val'>:field_type_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='option_id identifier id'>option_id</span><span class='comma token'>,</span> <span class='symbol val'>:field_type_type</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;MultiAnswerOption&quot;</span><span class='rparen token'>)</span>
            <span class='if if kw'>if</span> <span class='question identifier id'>question</span><span class='dot token'>.</span><span class='answer_type identifier id'>answer_type</span><span class='dot token'>.</span><span class='single? fid id'>single?</span>
              <span class='to_remove identifier id'>to_remove</span> <span class='opasgn op'>+=</span> <span class='lparen token'>(</span><span class='answer identifier id'>answer</span><span class='dot token'>.</span><span class='answer_parts identifier id'>answer_parts</span> <span class='minus op'>-</span> <span class='lbrack token'>[</span><span class='ap identifier id'>ap</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
            <span class='end end kw'>end</span>
            <span class='parts_to_save identifier id'>parts_to_save</span> <span class='lshft op'>&lt;&lt;</span> <span class='ap identifier id'>ap</span> <span class='if if_mod kw'>if</span> <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='new_record? fid id'>new_record?</span>
          <span class='end end kw'>end</span>
          <span class='if if kw'>if</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span> <span class='comment val'>#if the value selected is nil, we'll need to remove all or at least the deselected answer_parts</span>
            <span class='if if kw'>if</span> <span class='field_id identifier id'>field_id</span> <span class='comment val'>#if field_id is defined we'll remove the answer_part that refers to that field_id</span>
              <span class='ap identifier id'>ap</span> <span class='assign token'>=</span> <span class='answer identifier id'>answer</span><span class='dot token'>.</span><span class='answer_parts identifier id'>answer_parts</span><span class='dot token'>.</span><span class='find_by_field_type_id_and_field_type_type identifier id'>find_by_field_type_id_and_field_type_type</span><span class='lparen token'>(</span><span class='field_id identifier id'>field_id</span><span class='comma token'>,</span> <span class='string val'>&quot;MultiAnswerOption&quot;</span><span class='rparen token'>)</span>
              <span class='to_remove identifier id'>to_remove</span> <span class='lshft op'>&lt;&lt;</span> <span class='ap identifier id'>ap</span> <span class='if if_mod kw'>if</span> <span class='ap identifier id'>ap</span>
            <span class='else else kw'>else</span> <span class='comment val'>#if it's not defined just remove all the parts</span>
              <span class='to_remove identifier id'>to_remove</span> <span class='opasgn op'>+=</span> <span class='answer identifier id'>answer</span><span class='dot token'>.</span><span class='answer_parts identifier id'>answer_parts</span>
            <span class='end end kw'>end</span>
          <span class='end end kw'>end</span>
          <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='question identifier id'>question</span><span class='dot token'>.</span><span class='answer_type identifier id'>answer_type</span><span class='dot token'>.</span><span class='single? fid id'>single?</span> <span class='andop op'>&amp;&amp;</span> <span class='question identifier id'>question</span><span class='dot token'>.</span><span class='answer_type identifier id'>answer_type</span><span class='dot token'>.</span><span class='display_type identifier id'>display_type</span> <span class='eq op'>==</span> <span class='integer val'>1</span>
            <span class='to_remove identifier id'>to_remove</span> <span class='opasgn op'>+=</span> <span class='answer identifier id'>answer</span><span class='dot token'>.</span><span class='answer_parts identifier id'>answer_parts</span><span class='dot token'>.</span><span class='select identifier id'>select</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='ap identifier id'>ap</span><span class='bitor op'>|</span> <span class='notop op'>!</span><span class='parts_to_save identifier id'>parts_to_save</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='ap identifier id'>ap</span><span class='rparen token'>)</span><span class='rbrace token'>}</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>
      <span class='when when kw'>when</span> <span class='string val'>&quot;RankAnswer&quot;</span>
        <span class='comment val'>#Saving Rank Answer: input format of 'identifiers' =&gt; val</span>
        <span class='comment val'>#Rank Answer: &quot;question_id, loop_item_id, position(field_id)&quot; =&gt; selected_option_id || &quot;&quot; (val)</span>
        <span class='position identifier id'>position</span> <span class='assign token'>=</span> <span class='field_id identifier id'>field_id</span> <span class='comment val'>#= in the case of Rank Answer Type this refers to the position of the option with id =&gt; val</span>
        <span class='if if kw'>if</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='present? fid id'>present?</span><span class='comment val'>#if there's a value get or create an answer_part for that position and set it's value to be val</span>
          <span class='ap identifier id'>ap</span> <span class='assign token'>=</span> <span class='answer identifier id'>answer</span><span class='dot token'>.</span><span class='answer_parts identifier id'>answer_parts</span><span class='dot token'>.</span><span class='find_by_sort_index identifier id'>find_by_sort_index</span><span class='lparen token'>(</span><span class='position identifier id'>position</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='AnswerPart constant id'>AnswerPart</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:answer_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='answer identifier id'>answer</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='symbol val'>:sort_index</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='position identifier id'>position</span><span class='comma token'>,</span> <span class='symbol val'>:field_type_type</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;RankAnswerOption&quot;</span><span class='rparen token'>)</span>
          <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='field_type_id identifier id'>field_type_id</span> <span class='assign token'>=</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
          <span class='parts_to_save identifier id'>parts_to_save</span> <span class='lshft op'>&lt;&lt;</span> <span class='ap identifier id'>ap</span> <span class='if if_mod kw'>if</span> <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='changed? fid id'>changed?</span>
        <span class='else else kw'>else</span> <span class='comment val'>#if there's no value destroy answer_part if it exists</span>
          <span class='ap identifier id'>ap</span> <span class='assign token'>=</span> <span class='answer identifier id'>answer</span><span class='dot token'>.</span><span class='answer_parts identifier id'>answer_parts</span><span class='dot token'>.</span><span class='find_by_sort_index identifier id'>find_by_sort_index</span><span class='lparen token'>(</span><span class='position identifier id'>position</span><span class='rparen token'>)</span>
          <span class='to_remove identifier id'>to_remove</span> <span class='lshft op'>&lt;&lt;</span> <span class='ap identifier id'>ap</span> <span class='if if_mod kw'>if</span> <span class='ap identifier id'>ap</span>
        <span class='end end kw'>end</span>
      <span class='when when kw'>when</span> <span class='string val'>&quot;RangeAnswer&quot;</span>
        <span class='comment val'>#Saving Range Answers, input format of 'identifiers =&gt; val</span>
        <span class='comment val'>#Range Answer: &quot;question_id, loop_item_id, option_id(field_id)&quot; =&gt; option_id || &quot;&quot; (val)</span>
        <span class='comment val'>#for range answers field_id is the same as val, unless val is blank, which means that it was cleared the answer</span>
        <span class='answer identifier id'>answer</span><span class='dot token'>.</span><span class='answer_parts identifier id'>answer_parts</span><span class='dot token'>.</span><span class='delete_all identifier id'>delete_all</span> <span class='if if_mod kw'>if</span> <span class='answer identifier id'>answer</span><span class='dot token'>.</span><span class='answer_parts identifier id'>answer_parts</span><span class='dot token'>.</span><span class='count identifier id'>count</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span>
        <span class='if if kw'>if</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='present? fid id'>present?</span>
          <span class='ap identifier id'>ap</span> <span class='assign token'>=</span> <span class='answer identifier id'>answer</span><span class='dot token'>.</span><span class='answer_parts identifier id'>answer_parts</span><span class='dot token'>.</span><span class='first identifier id'>first</span> <span class='orop op'>||</span> <span class='AnswerPart constant id'>AnswerPart</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:answer_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='answer identifier id'>answer</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='symbol val'>:field_type_type</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;RangeAnswerOption&quot;</span><span class='rparen token'>)</span>
          <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='field_type_id identifier id'>field_type_id</span> <span class='assign token'>=</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
          <span class='parts_to_save identifier id'>parts_to_save</span> <span class='lshft op'>&lt;&lt;</span> <span class='ap identifier id'>ap</span> <span class='if if_mod kw'>if</span> <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='changed? fid id'>changed?</span>
        <span class='else else kw'>else</span> <span class='comment val'>#delete existing answer_part</span>
          <span class='ap identifier id'>ap</span> <span class='assign token'>=</span> <span class='answer identifier id'>answer</span><span class='dot token'>.</span><span class='answer_parts identifier id'>answer_parts</span><span class='dot token'>.</span><span class='first identifier id'>first</span> 
          <span class='to_remove identifier id'>to_remove</span> <span class='lshft op'>&lt;&lt;</span> <span class='ap identifier id'>ap</span> <span class='if if_mod kw'>if</span> <span class='ap identifier id'>ap</span>
        <span class='end end kw'>end</span>
      <span class='when when kw'>when</span> <span class='string val'>&quot;MatrixAnswer&quot;</span>
        <span class='comment val'>## Saving Matrix Answers, input format of 'identifiers'=&gt; val:</span>
        <span class='comment val'>## Check-boxes: &quot;question_id, loop_item_id, query_id(field_id), option_id(extra_val) =&gt; option_id || &quot;&quot; (val)</span>
        <span class='comment val'>## Radio-Buttons: &quot;question_id, loop_item_id, query_id(field_id), option_id(extra_val) =&gt; option_id || &quot;&quot; (val)</span>
        <span class='comment val'>## Text-fields: &quot;question_id, loop_item_id, query_id(field_id), option_id(extra_val) =&gt; text answer</span>
        <span class='comment val'>## Drop-Down-Lists: &quot;question_id, loop_item_id, query_id(field_id), option_id(extra_val) =&gt; selection (drop_down_option_id) (val)&quot;</span>
        <span class='option_id identifier id'>option_id</span> <span class='assign token'>=</span> <span class='extra_val identifier id'>extra_val</span>
        <span class='ap identifier id'>ap</span> <span class='assign token'>=</span> <span class='answer identifier id'>answer</span><span class='dot token'>.</span><span class='answer_parts identifier id'>answer_parts</span><span class='dot token'>.</span><span class='find_by_field_type_id_and_field_type_type identifier id'>find_by_field_type_id_and_field_type_type</span><span class='lparen token'>(</span><span class='field_id identifier id'>field_id</span><span class='comma token'>,</span> <span class='string val'>&quot;MatrixAnswerQuery&quot;</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='AnswerPart constant id'>AnswerPart</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:answer_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='answer identifier id'>answer</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='symbol val'>:field_type_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='field_id identifier id'>field_id</span><span class='comma token'>,</span> <span class='symbol val'>:field_type_type</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;MatrixAnswerQuery&quot;</span><span class='rparen token'>)</span>
        <span class='parts_to_save identifier id'>parts_to_save</span> <span class='lshft op'>&lt;&lt;</span> <span class='ap identifier id'>ap</span><span class='comment val'># if ap.new_record?</span>
        <span class='if if kw'>if</span> <span class='question identifier id'>question</span><span class='dot token'>.</span><span class='answer_type identifier id'>answer_type</span><span class='dot token'>.</span><span class='radio_button? fid id'>radio_button?</span>
          <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='answer_part_matrix_options identifier id'>answer_part_matrix_options</span><span class='dot token'>.</span><span class='delete_all identifier id'>delete_all</span> <span class='if if_mod kw'>if</span> <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='answer_part_matrix_options identifier id'>answer_part_matrix_options</span><span class='dot token'>.</span><span class='count identifier id'>count</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span>
          <span class='if if kw'>if</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='present? fid id'>present?</span><span class='comment val'>#set the value if it was chosen</span>
            <span class='apmo identifier id'>apmo</span> <span class='assign token'>=</span> <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='answer_part_matrix_options identifier id'>answer_part_matrix_options</span><span class='dot token'>.</span><span class='first identifier id'>first</span> <span class='orop op'>||</span> <span class='AnswerPartMatrixOption constant id'>AnswerPartMatrixOption</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
            <span class='apmo identifier id'>apmo</span><span class='dot token'>.</span><span class='matrix_answer_option_id identifier id'>matrix_answer_option_id</span> <span class='assign token'>=</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
            <span class='parts_to_save identifier id'>parts_to_save</span> <span class='lshft op'>&lt;&lt;</span> <span class='apmo identifier id'>apmo</span> <span class='if if_mod kw'>if</span> <span class='apmo identifier id'>apmo</span><span class='dot token'>.</span><span class='changed? fid id'>changed?</span>
            <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='answer_part_matrix_options identifier id'>answer_part_matrix_options</span> <span class='lshft op'>&lt;&lt;</span> <span class='apmo identifier id'>apmo</span> <span class='unless unless_mod kw'>unless</span> <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='answer_part_matrix_options identifier id'>answer_part_matrix_options</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='apmo identifier id'>apmo</span><span class='rparen token'>)</span>
          <span class='else else kw'>else</span><span class='comment val'>#delete AnswerPartMatrixOption if it exists and was unselected</span>
            <span class='apmo identifier id'>apmo</span> <span class='assign token'>=</span> <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='answer_part_matrix_options identifier id'>answer_part_matrix_options</span><span class='dot token'>.</span><span class='first identifier id'>first</span> 
            <span class='to_remove identifier id'>to_remove</span> <span class='lshft op'>&lt;&lt;</span> <span class='apmo identifier id'>apmo</span> <span class='if if_mod kw'>if</span> <span class='apmo identifier id'>apmo</span>
          <span class='end end kw'>end</span>
        <span class='elsif elsif kw'>elsif</span> <span class='question identifier id'>question</span><span class='dot token'>.</span><span class='answer_type identifier id'>answer_type</span><span class='dot token'>.</span><span class='text_field? fid id'>text_field?</span>
          <span class='if if kw'>if</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='present? fid id'>present?</span>
            <span class='apmo identifier id'>apmo</span> <span class='assign token'>=</span> <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='answer_part_matrix_options identifier id'>answer_part_matrix_options</span><span class='dot token'>.</span><span class='find_by_matrix_answer_option_id identifier id'>find_by_matrix_answer_option_id</span><span class='lparen token'>(</span><span class='option_id identifier id'>option_id</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='AnswerPartMatrixOption constant id'>AnswerPartMatrixOption</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:matrix_answer_option_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='option_id identifier id'>option_id</span><span class='rparen token'>)</span>
            <span class='apmo identifier id'>apmo</span><span class='dot token'>.</span><span class='answer_text identifier id'>answer_text</span> <span class='assign token'>=</span> <span class='val identifier id'>val</span>
            <span class='parts_to_save identifier id'>parts_to_save</span> <span class='lshft op'>&lt;&lt;</span> <span class='apmo identifier id'>apmo</span> <span class='if if_mod kw'>if</span> <span class='apmo identifier id'>apmo</span><span class='dot token'>.</span><span class='changed? fid id'>changed?</span>
            <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='answer_part_matrix_options identifier id'>answer_part_matrix_options</span> <span class='lshft op'>&lt;&lt;</span> <span class='apmo identifier id'>apmo</span> <span class='unless unless_mod kw'>unless</span> <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='answer_part_matrix_options identifier id'>answer_part_matrix_options</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='apmo identifier id'>apmo</span><span class='rparen token'>)</span>
          <span class='else else kw'>else</span>
            <span class='apmo identifier id'>apmo</span> <span class='assign token'>=</span> <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='answer_part_matrix_options identifier id'>answer_part_matrix_options</span><span class='dot token'>.</span><span class='find_by_matrix_answer_option_id identifier id'>find_by_matrix_answer_option_id</span><span class='lparen token'>(</span><span class='option_id identifier id'>option_id</span><span class='rparen token'>)</span>
            <span class='to_remove identifier id'>to_remove</span> <span class='lshft op'>&lt;&lt;</span> <span class='apmo identifier id'>apmo</span> <span class='if if_mod kw'>if</span> <span class='apmo identifier id'>apmo</span>
          <span class='end end kw'>end</span>
        <span class='elsif elsif kw'>elsif</span> <span class='question identifier id'>question</span><span class='dot token'>.</span><span class='answer_type identifier id'>answer_type</span><span class='dot token'>.</span><span class='check_box? fid id'>check_box?</span>
          <span class='if if kw'>if</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='present? fid id'>present?</span>
            <span class='apmo identifier id'>apmo</span> <span class='assign token'>=</span> <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='answer_part_matrix_options identifier id'>answer_part_matrix_options</span><span class='dot token'>.</span><span class='find_by_matrix_answer_option_id identifier id'>find_by_matrix_answer_option_id</span><span class='lparen token'>(</span><span class='option_id identifier id'>option_id</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='AnswerPartMatrixOption constant id'>AnswerPartMatrixOption</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
            <span class='apmo identifier id'>apmo</span><span class='dot token'>.</span><span class='matrix_answer_option_id identifier id'>matrix_answer_option_id</span> <span class='assign token'>=</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
            <span class='parts_to_save identifier id'>parts_to_save</span> <span class='lshft op'>&lt;&lt;</span> <span class='apmo identifier id'>apmo</span> <span class='if if_mod kw'>if</span> <span class='apmo identifier id'>apmo</span><span class='dot token'>.</span><span class='changed? fid id'>changed?</span>
            <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='answer_part_matrix_options identifier id'>answer_part_matrix_options</span> <span class='lshft op'>&lt;&lt;</span> <span class='apmo identifier id'>apmo</span> <span class='unless unless_mod kw'>unless</span> <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='answer_part_matrix_options identifier id'>answer_part_matrix_options</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='apmo identifier id'>apmo</span><span class='rparen token'>)</span>
          <span class='else else kw'>else</span>
            <span class='apmo identifier id'>apmo</span> <span class='assign token'>=</span> <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='answer_part_matrix_options identifier id'>answer_part_matrix_options</span><span class='dot token'>.</span><span class='find_by_matrix_answer_option_id identifier id'>find_by_matrix_answer_option_id</span><span class='lparen token'>(</span><span class='option_id identifier id'>option_id</span><span class='rparen token'>)</span>
            <span class='to_remove identifier id'>to_remove</span> <span class='lshft op'>&lt;&lt;</span> <span class='apmo identifier id'>apmo</span> <span class='if if_mod kw'>if</span> <span class='apmo identifier id'>apmo</span>
          <span class='end end kw'>end</span>
        <span class='elsif elsif kw'>elsif</span> <span class='question identifier id'>question</span><span class='dot token'>.</span><span class='answer_type identifier id'>answer_type</span><span class='dot token'>.</span><span class='drop_down_list? fid id'>drop_down_list?</span>
          <span class='if if kw'>if</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='present? fid id'>present?</span>
            <span class='apmo identifier id'>apmo</span> <span class='assign token'>=</span> <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='answer_part_matrix_options identifier id'>answer_part_matrix_options</span><span class='dot token'>.</span><span class='find_by_matrix_answer_option_id identifier id'>find_by_matrix_answer_option_id</span><span class='lparen token'>(</span><span class='option_id identifier id'>option_id</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='AnswerPartMatrixOption constant id'>AnswerPartMatrixOption</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:matrix_answer_option_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='option_id identifier id'>option_id</span><span class='rparen token'>)</span>
            <span class='apmo identifier id'>apmo</span><span class='dot token'>.</span><span class='matrix_answer_drop_option_id identifier id'>matrix_answer_drop_option_id</span> <span class='assign token'>=</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
            <span class='parts_to_save identifier id'>parts_to_save</span> <span class='lshft op'>&lt;&lt;</span> <span class='apmo identifier id'>apmo</span> <span class='if if_mod kw'>if</span> <span class='apmo identifier id'>apmo</span><span class='dot token'>.</span><span class='changed? fid id'>changed?</span>
            <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='answer_part_matrix_options identifier id'>answer_part_matrix_options</span> <span class='lshft op'>&lt;&lt;</span> <span class='apmo identifier id'>apmo</span> <span class='unless unless_mod kw'>unless</span> <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='answer_part_matrix_options identifier id'>answer_part_matrix_options</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='apmo identifier id'>apmo</span><span class='rparen token'>)</span>
          <span class='else else kw'>else</span>
            <span class='apmo identifier id'>apmo</span> <span class='assign token'>=</span> <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='answer_part_matrix_options identifier id'>answer_part_matrix_options</span><span class='dot token'>.</span><span class='find_by_matrix_answer_option_id identifier id'>find_by_matrix_answer_option_id</span><span class='lparen token'>(</span><span class='option_id identifier id'>option_id</span><span class='rparen token'>)</span>
            <span class='to_remove identifier id'>to_remove</span> <span class='lshft op'>&lt;&lt;</span> <span class='apmo identifier id'>apmo</span> <span class='if if_mod kw'>if</span> <span class='apmo identifier id'>apmo</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='notop op'>!</span><span class='parts_to_save identifier id'>parts_to_save</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> <span class='orop op'>||</span> <span class='notop op'>!</span><span class='to_remove identifier id'>to_remove</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span><span class='rparen token'>)</span> <span class='comment val'>#returns true if something has changed</span>
  <span class='if if kw'>if</span> <span class='result identifier id'>result</span>
    <span class='answers identifier id'>answers</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='symbol val'>:save</span><span class='rparen token'>)</span>
    <span class='parts_to_save identifier id'>parts_to_save</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='symbol val'>:save</span><span class='rparen token'>)</span>
    <span class='to_remove identifier id'>to_remove</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='symbol val'>:delete</span><span class='rparen token'>)</span>
    <span class='sections_updated_state identifier id'>sections_updated_state</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='answers identifier id'>answers</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='a identifier id'>a</span><span class='bitor op'>|</span>
      <span class='unless unless kw'>unless</span> <span class='sections_updated_state identifier id'>sections_updated_state</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='a identifier id'>a</span><span class='dot token'>.</span><span class='question identifier id'>question</span><span class='dot token'>.</span><span class='section identifier id'>section</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='a identifier id'>a</span><span class='dot token'>.</span><span class='loop_item_id identifier id'>loop_item_id</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
        <span class='a identifier id'>a</span><span class='dot token'>.</span><span class='question identifier id'>question</span><span class='dot token'>.</span><span class='section identifier id'>section</span><span class='dot token'>.</span><span class='update_submission_state! fid id'>update_submission_state!</span><span class='lparen token'>(</span><span class='user identifier id'>user</span><span class='comma token'>,</span> <span class='a identifier id'>a</span><span class='dot token'>.</span><span class='loop_item_id identifier id'>loop_item_id</span><span class='rparen token'>)</span>
        <span class='sections_updated_state identifier id'>sections_updated_state</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrack token'>[</span><span class='a identifier id'>a</span><span class='dot token'>.</span><span class='question identifier id'>question</span><span class='dot token'>.</span><span class='section identifier id'>section</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='a identifier id'>a</span><span class='dot token'>.</span><span class='loop_item_id identifier id'>loop_item_id</span><span class='rbrack token'>]</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='Section constant id'>Section</span><span class='dot token'>.</span><span class='dependent_availability_changes identifier id'>dependent_availability_changes</span><span class='lparen token'>(</span><span class='dependent_sections_state identifier id'>dependent_sections_state</span><span class='comma token'>,</span> <span class='user identifier id'>user</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='dependent_sections_state identifier id'>dependent_sections_state</span>
  <span class='end end kw'>end</span>
  <span class='lbrack token'>[</span> <span class='result identifier id'>result</span><span class='comma token'>,</span> <span class='parts_to_save identifier id'>parts_to_save</span><span class='dot token'>.</span><span class='select identifier id'>select</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='part identifier id'>part</span><span class='bitor op'>|</span> <span class='part identifier id'>part</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='AnswerPart constant id'>AnswerPart</span><span class='rparen token'>)</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='ap identifier id'>ap</span><span class='bitor op'>|</span> <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='answer identifier id'>answer</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='uniq identifier id'>uniq</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='a identifier id'>a</span><span class='bitor op'>|</span> <span class='a identifier id'>a</span><span class='dot token'>.</span><span class='question_id identifier id'>question_id</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span> <span class='plus op'>+</span> <span class='lparen token'>(</span><span class='a identifier id'>a</span><span class='dot token'>.</span><span class='loop_item_id identifier id'>loop_item_id</span> <span class='integer val'>? </span><span class='string val'>&quot;_&quot;</span><span class='plus op'>+</span><span class='a identifier id'>a</span><span class='dot token'>.</span><span class='loop_item_id identifier id'>loop_item_id</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span> <span class='colon op'>:</span> <span class='string val'>&quot;&quot;</span><span class='rparen token'>)</span><span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="validate_the_urls-class_method">
  
    + (<tt>Object</tt>) <strong>validate_the_urls</strong>(params) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


55
56
57
58
59
60
61
62
63
64
65
66
67</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/answer.rb', line 55</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='validate_the_urls identifier id'>validate_the_urls</span> <span class='params identifier id'>params</span>
  <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:answer_links_attributes</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span><span class='lparen token'>(</span><span class='string val'>&quot;new_answer_links&quot;</span><span class='rparen token'>)</span>
  <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:answer_links_attributes</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='values identifier id'>values</span><span class='bitor op'>|</span>
    <span class='begin begin kw'>begin</span>
      <span class='aux identifier id'>aux</span> <span class='assign token'>=</span> <span class='URI constant id'>URI</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='values identifier id'>values</span><span class='lbrack token'>[</span><span class='string val'>&quot;url&quot;</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
      <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='aux identifier id'>aux</span><span class='dot token'>.</span><span class='scheme identifier id'>scheme</span> <span class='andop op'>&amp;&amp;</span> <span class='values identifier id'>values</span><span class='lbrack token'>[</span><span class='symbol val'>:url</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='present? fid id'>present?</span>
        <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:answer_links_attributes</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='id identifier id'>id</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:url</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>&quot;http://&quot;</span> <span class='plus op'>+</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:answer_links_attributes</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='id identifier id'>id</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:url</span><span class='rbrack token'>]</span>
      <span class='end end kw'>end</span>
    <span class='rescue rescue kw'>rescue</span> <span class='URI constant id'>URI</span><span class='colon2 op'>::</span><span class='InvalidURIError constant id'>InvalidURIError</span>
      <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:answer_links_attributes</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='id identifier id'>id</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:_destroy</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='integer val'>1</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="clone_answer_details-instance_method">
  
    - (<tt>Object</tt>) <strong>clone_answer_details</strong>(questions_link, options_link, text_fields_link, numeric_answers_link, loop_items_link) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Methods
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


44
45
46
47
48
49
50
51
52
53</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/answer.rb', line 44</span>

<span class='def def kw'>def</span> <span class='clone_answer_details identifier id'>clone_answer_details</span><span class='lparen token'>(</span><span class='questions_link identifier id'>questions_link</span><span class='comma token'>,</span> <span class='options_link identifier id'>options_link</span><span class='comma token'>,</span> <span class='text_fields_link identifier id'>text_fields_link</span><span class='comma token'>,</span> <span class='numeric_answers_link identifier id'>numeric_answers_link</span><span class='comma token'>,</span> <span class='loop_items_link identifier id'>loop_items_link</span><span class='rparen token'>)</span>
  <span class='comment val'>#TODO: Clone the loop_item_id to the new loop_item_id!</span>
  <span class='new_answer identifier id'>new_answer</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='clone_object identifier id'>clone_object</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='symbol val'>:user_id</span><span class='comma token'>,</span> <span class='symbol val'>:other_text</span><span class='comma token'>,</span> <span class='symbol val'>:documents</span><span class='comma token'>,</span> <span class='symbol val'>:looping_identifier</span><span class='comma token'>,</span> <span class='symbol val'>:from_dependent_section</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='new_answer identifier id'>new_answer</span><span class='dot token'>.</span><span class='question identifier id'>question</span> <span class='assign token'>=</span> <span class='questions_link identifier id'>questions_link</span><span class='lbrack token'>[</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='question identifier id'>question</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span>
  <span class='new_answer identifier id'>new_answer</span><span class='dot token'>.</span><span class='loop_item identifier id'>loop_item</span> <span class='assign token'>=</span> <span class='loop_items_link identifier id'>loop_items_link</span><span class='lbrack token'>[</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='loop_item identifier id'>loop_item</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='loop_item identifier id'>loop_item</span><span class='dot token'>.</span><span class='present? fid id'>present?</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='answer_parts identifier id'>answer_parts</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='answer_part identifier id'>answer_part</span><span class='bitor op'>|</span>
    <span class='new_answer identifier id'>new_answer</span><span class='dot token'>.</span><span class='answer_parts identifier id'>answer_parts</span> <span class='lshft op'>&lt;&lt;</span> <span class='answer_part identifier id'>answer_part</span><span class='dot token'>.</span><span class='clone_answer_part identifier id'>clone_answer_part</span><span class='lparen token'>(</span><span class='options_link identifier id'>options_link</span><span class='comma token'>,</span> <span class='text_fields_link identifier id'>text_fields_link</span><span class='comma token'>,</span> <span class='numeric_answers_link identifier id'>numeric_answers_link</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='new_answer identifier id'>new_answer</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_text_answer_field_if_it_exists-instance_method">
  
    - (<tt>Object</tt>) <strong>get_text_answer_field_if_it_exists</strong>(text_answer_field, translator_visible) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
for text_answer type answers
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


70
71
72
73
74
75
76
77
78
79
80
81</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/answer.rb', line 70</span>

<span class='def def kw'>def</span> <span class='get_text_answer_field_if_it_exists identifier id'>get_text_answer_field_if_it_exists</span> <span class='text_answer_field identifier id'>text_answer_field</span><span class='comma token'>,</span> <span class='translator_visible identifier id'>translator_visible</span>
  <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='ap identifier id'>ap</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='answer_parts identifier id'>answer_parts</span><span class='dot token'>.</span><span class='find_by_field_type_id identifier id'>find_by_field_type_id</span><span class='lparen token'>(</span><span class='text_answer_field identifier id'>text_answer_field</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='ap identifier id'>ap</span>
    <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='symbol val'>:answer_text</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='answer_text identifier id'>answer_text</span> <span class='orop op'>||</span> <span class='string val'>&quot;&quot;</span>
    <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='symbol val'>:original_language</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='original_language identifier id'>original_language</span><span class='dot token'>.</span><span class='present? fid id'>present?</span> <span class='integer val'>? </span><span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='original_language identifier id'>original_language</span> <span class='colon op'>:</span>  <span class='nil nil kw'>nil</span>
    <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='symbol val'>:answer_text_in_english</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='ap identifier id'>ap</span><span class='dot token'>.</span><span class='answer_text_in_english identifier id'>answer_text_in_english</span> <span class='orop op'>||</span> <span class='string val'>&quot;&quot;</span> <span class='if if_mod kw'>if</span> <span class='translator_visible identifier id'>translator_visible</span>
    <span class='result identifier id'>result</span>
  <span class='else else kw'>else</span>
    <span class='nil nil kw'>nil</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="matrix_cells_answers-instance_method">
  
    - (<tt>Object</tt>) <strong>matrix_cells_answers</strong>(selection) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


83
84
85
86
87
88
89
90
91
92
93
94
95
96
97</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/answer.rb', line 83</span>

<span class='def def kw'>def</span> <span class='matrix_cells_answers identifier id'>matrix_cells_answers</span> <span class='selection identifier id'>selection</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='answer_parts identifier id'>answer_parts</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='answer_part identifier id'>answer_part</span><span class='bitor op'>|</span>
    <span class='selection identifier id'>selection</span><span class='lbrack token'>[</span><span class='answer_part identifier id'>answer_part</span><span class='dot token'>.</span><span class='field_type_id identifier id'>field_type_id</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
    <span class='answer_part identifier id'>answer_part</span><span class='dot token'>.</span><span class='answer_part_matrix_options identifier id'>answer_part_matrix_options</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='apmo identifier id'>apmo</span><span class='bitor op'>|</span>
      <span class='selection identifier id'>selection</span><span class='lbrack token'>[</span><span class='answer_part identifier id'>answer_part</span><span class='dot token'>.</span><span class='field_type_id identifier id'>field_type_id</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='apmo identifier id'>apmo</span><span class='dot token'>.</span><span class='matrix_answer_option_id identifier id'>matrix_answer_option_id</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
      <span class='if if kw'>if</span> <span class='apmo identifier id'>apmo</span><span class='dot token'>.</span><span class='answer_text identifier id'>answer_text</span><span class='dot token'>.</span><span class='present? fid id'>present?</span>
        <span class='selection identifier id'>selection</span><span class='lbrack token'>[</span><span class='answer_part identifier id'>answer_part</span><span class='dot token'>.</span><span class='field_type_id identifier id'>field_type_id</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='apmo identifier id'>apmo</span><span class='dot token'>.</span><span class='matrix_answer_option_id identifier id'>matrix_answer_option_id</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='apmo identifier id'>apmo</span><span class='dot token'>.</span><span class='answer_text identifier id'>answer_text</span>
      <span class='elsif elsif kw'>elsif</span> <span class='apmo identifier id'>apmo</span><span class='dot token'>.</span><span class='matrix_answer_drop_option_id identifier id'>matrix_answer_drop_option_id</span>
        <span class='selection identifier id'>selection</span><span class='lbrack token'>[</span><span class='answer_part identifier id'>answer_part</span><span class='dot token'>.</span><span class='field_type_id identifier id'>field_type_id</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='apmo identifier id'>apmo</span><span class='dot token'>.</span><span class='matrix_answer_option_id identifier id'>matrix_answer_option_id</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='apmo identifier id'>apmo</span><span class='dot token'>.</span><span class='matrix_answer_drop_option_id identifier id'>matrix_answer_drop_option_id</span>
      <span class='else else kw'>else</span>
        <span class='selection identifier id'>selection</span><span class='lbrack token'>[</span><span class='answer_part identifier id'>answer_part</span><span class='dot token'>.</span><span class='field_type_id identifier id'>field_type_id</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='apmo identifier id'>apmo</span><span class='dot token'>.</span><span class='matrix_answer_option_id identifier id'>matrix_answer_option_id</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Fri Jul  8 14:33:38 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.2 (ruby-1.8.7).
</div>

  </body>
</html>