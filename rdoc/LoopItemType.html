<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: LoopItemType
  
    &mdash; Documentation by YARD 0.7.2
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (L)</a> &raquo; 
    
    
    <span class="title">LoopItemType</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: LoopItemType
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">ActiveRecord::Base</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActiveRecord::Base</li>
          
            <li class="next">LoopItemType</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">app/models/loop_item_type.rb</dd>
  
</dl>
<div class="clear"></div>



  


  

  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clone_loop_item_type-instance_method" title="#clone_loop_item_type (instance method)">- (Object) <strong>clone_loop_item_type</strong>(loop_item_types_link, loop_items_link, loop_item_names_link, extras_link) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#existing_item_with-instance_method" title="#existing_item_with (instance method)">- (Object) <strong>existing_item_with</strong>(the_name, parent, default_language) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_bottom_boundary-instance_method" title="#get_bottom_boundary (instance method)">- (Object) <strong>get_bottom_boundary</strong>(section) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
get the first occurrence of an item of self.loop_source that is a
descendant of section.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_upper_boundary-instance_method" title="#get_upper_boundary (instance method)">- (Object) <strong>get_upper_boundary</strong>(section) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
get the first occurrence of an item of self.loop_source that is an ancestor
of section.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_upper_boundary_when_editing-instance_method" title="#get_upper_boundary_when_editing (instance method)">- (Object) <strong>get_upper_boundary_when_editing</strong>(section) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
get the first occurrence of an item of self.loop_source that is an ancestor
of section | for when editing a section.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#handle_source-instance_method" title="#handle_source (instance method)">- (Object) <strong>handle_source</strong>(file_path, status) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#in_bounds%3F-instance_method" title="#in_bounds? (instance method)">- (Boolean) <strong>in_bounds?</strong>(upper_boundary) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
check if a loop_item_type is inside the upper and bottom boundary for a
specific section.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#in_bounds_when_editing%3F-instance_method" title="#in_bounds_when_editing? (instance method)">- (Boolean) <strong>in_bounds_when_editing?</strong>(bottom_boundary, upper_boundary) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#is_filtering_field%3F-instance_method" title="#is_filtering_field? (instance method)">- (Boolean) <strong>is_filtering_field?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#leaf_loop_items_sorted-instance_method" title="#leaf_loop_items_sorted (instance method)">- (Object) <strong>leaf_loop_items_sorted</strong>(params) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#loop_item_name_with-instance_method" title="#loop_item_name_with (instance method)">- (Object) <strong>loop_item_name_with</strong>(the_name, default_language) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Fetches the LoopItemName that has a a loop_item_name_field with item_name
as &#8216;the_name&#8217; Passes in the default language to specify if a
new LoopItemNameField needs to be created.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#source_headers_ok%3F-instance_method" title="#source_headers_ok? (instance method)">- (Boolean) <strong>source_headers_ok?</strong>(header_row, status) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="clone_loop_item_type-instance_method">
  
    - (<tt>Object</tt>) <strong>clone_loop_item_type</strong>(loop_item_types_link, loop_items_link, loop_item_names_link, extras_link) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/loop_item_type.rb', line 71</span>

<span class='def def kw'>def</span> <span class='clone_loop_item_type identifier id'>clone_loop_item_type</span> <span class='loop_item_types_link identifier id'>loop_item_types_link</span><span class='comma token'>,</span> <span class='loop_items_link identifier id'>loop_items_link</span><span class='comma token'>,</span> <span class='loop_item_names_link identifier id'>loop_item_names_link</span><span class='comma token'>,</span> <span class='extras_link identifier id'>extras_link</span>
  <span class='new_loop_item_type identifier id'>new_loop_item_type</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='clone_object identifier id'>clone_object</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='symbol val'>:name</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='comment val'>#clone children loop_item_types</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='children identifier id'>children</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='child identifier id'>child</span><span class='bitor op'>|</span>
    <span class='new_loop_item_type identifier id'>new_loop_item_type</span><span class='dot token'>.</span><span class='children identifier id'>children</span> <span class='lshft op'>&lt;&lt;</span> <span class='child identifier id'>child</span><span class='dot token'>.</span><span class='clone_loop_item_type identifier id'>clone_loop_item_type</span><span class='lparen token'>(</span><span class='loop_item_types_link identifier id'>loop_item_types_link</span><span class='comma token'>,</span> <span class='loop_items_link identifier id'>loop_items_link</span><span class='comma token'>,</span> <span class='loop_item_names_link identifier id'>loop_item_names_link</span><span class='comma token'>,</span> <span class='extras_link identifier id'>extras_link</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='comment val'>#clone the loop_items of each loop_item_type, hierarchy between loop_items is not maintained at this point</span>
  <span class='comment val'>#but it's done after all loop_item_types have been cloned (vide loop_source.rb)</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='loop_items identifier id'>loop_items</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='item identifier id'>item</span><span class='bitor op'>|</span>
    <span class='new_loop_item identifier id'>new_loop_item</span> <span class='assign token'>=</span> <span class='item identifier id'>item</span><span class='dot token'>.</span><span class='clone_object identifier id'>clone_object</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='symbol val'>:sort_index</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>

    <span class='if if kw'>if</span> <span class='loop_item_names_link identifier id'>loop_item_names_link</span><span class='lbrack token'>[</span><span class='item identifier id'>item</span><span class='dot token'>.</span><span class='loop_item_name_id identifier id'>loop_item_name_id</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span>
      <span class='new_loop_item identifier id'>new_loop_item</span><span class='dot token'>.</span><span class='loop_item_name identifier id'>loop_item_name</span> <span class='assign token'>=</span> <span class='loop_item_names_link identifier id'>loop_item_names_link</span><span class='lbrack token'>[</span><span class='item identifier id'>item</span><span class='dot token'>.</span><span class='loop_item_name_id identifier id'>loop_item_name_id</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span>
    <span class='else else kw'>else</span>
      <span class='comment val'>#create a new LoopItemName, clonning its loop_item_name_fields</span>
      <span class='new_loop_item_name identifier id'>new_loop_item_name</span> <span class='assign token'>=</span> <span class='item identifier id'>item</span><span class='dot token'>.</span><span class='loop_item_name identifier id'>loop_item_name</span><span class='dot token'>.</span><span class='clone identifier id'>clone</span>
      <span class='item identifier id'>item</span><span class='dot token'>.</span><span class='loop_item_name identifier id'>loop_item_name</span><span class='dot token'>.</span><span class='loop_item_name_fields identifier id'>loop_item_name_fields</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='litem_name_field identifier id'>litem_name_field</span><span class='bitor op'>|</span>
        <span class='new_litem_name_field identifier id'>new_litem_name_field</span> <span class='assign token'>=</span> <span class='litem_name_field identifier id'>litem_name_field</span><span class='dot token'>.</span><span class='clone_object identifier id'>clone_object</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='symbol val'>:language</span><span class='comma token'>,</span> <span class='symbol val'>:is_default_language</span><span class='comma token'>,</span> <span class='symbol val'>:item_name</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
        <span class='new_loop_item_name identifier id'>new_loop_item_name</span><span class='dot token'>.</span><span class='loop_item_name_fields identifier id'>loop_item_name_fields</span> <span class='lshft op'>&lt;&lt;</span> <span class='new_litem_name_field identifier id'>new_litem_name_field</span>
      <span class='end end kw'>end</span>
      <span class='new_loop_item identifier id'>new_loop_item</span><span class='dot token'>.</span><span class='loop_item_name identifier id'>loop_item_name</span> <span class='assign token'>=</span> <span class='new_loop_item_name identifier id'>new_loop_item_name</span>
      <span class='loop_item_names_link identifier id'>loop_item_names_link</span><span class='lbrack token'>[</span><span class='item identifier id'>item</span><span class='dot token'>.</span><span class='loop_item_name_id identifier id'>loop_item_name_id</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='new_loop_item_name identifier id'>new_loop_item_name</span>
      <span class='new_loop_item_type identifier id'>new_loop_item_type</span><span class='dot token'>.</span><span class='loop_item_names identifier id'>loop_item_names</span> <span class='lshft op'>&lt;&lt;</span> <span class='new_loop_item_name identifier id'>new_loop_item_name</span>
    <span class='end end kw'>end</span>
    <span class='new_loop_item_type identifier id'>new_loop_item_type</span><span class='dot token'>.</span><span class='loop_items identifier id'>loop_items</span> <span class='lshft op'>&lt;&lt;</span> <span class='new_loop_item identifier id'>new_loop_item</span>
    <span class='loop_items_link identifier id'>loop_items_link</span><span class='lbrack token'>[</span><span class='item identifier id'>item</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='new_loop_item identifier id'>new_loop_item</span>
  <span class='end end kw'>end</span>

  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='extras identifier id'>extras</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='extra identifier id'>extra</span><span class='bitor op'>|</span>
    <span class='new_loop_item_type identifier id'>new_loop_item_type</span><span class='dot token'>.</span><span class='extras identifier id'>extras</span> <span class='lshft op'>&lt;&lt;</span> <span class='extra identifier id'>extra</span><span class='dot token'>.</span><span class='clone_extra_and_item_extras identifier id'>clone_extra_and_item_extras</span><span class='lparen token'>(</span><span class='loop_item_names_link identifier id'>loop_item_names_link</span><span class='comma token'>,</span> <span class='extras_link identifier id'>extras_link</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='loop_item_types_link identifier id'>loop_item_types_link</span><span class='lbrack token'>[</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='new_loop_item_type identifier id'>new_loop_item_type</span>
  <span class='new_loop_item_type identifier id'>new_loop_item_type</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="existing_item_with-instance_method">
  
    - (<tt>Object</tt>) <strong>existing_item_with</strong>(the_name, parent, default_language) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/loop_item_type.rb', line 233</span>

<span class='def def kw'>def</span> <span class='existing_item_with identifier id'>existing_item_with</span><span class='lparen token'>(</span> <span class='the_name identifier id'>the_name</span><span class='comma token'>,</span> <span class='parent identifier id'>parent</span><span class='comma token'>,</span> <span class='default_language identifier id'>default_language</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='parent identifier id'>parent</span>
    <span class='parent identifier id'>parent</span><span class='dot token'>.</span><span class='children identifier id'>children</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='child identifier id'>child</span><span class='bitor op'>|</span>
      <span class='if if kw'>if</span> <span class='child identifier id'>child</span><span class='dot token'>.</span><span class='loop_item_type identifier id'>loop_item_type</span> <span class='eq op'>==</span> <span class='self self kw'>self</span> <span class='andop op'>&amp;&amp;</span> <span class='child identifier id'>child</span><span class='dot token'>.</span><span class='item_name identifier id'>item_name</span><span class='lparen token'>(</span><span class='default_language identifier id'>default_language</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='downcase identifier id'>downcase</span> <span class='eq op'>==</span> <span class='the_name identifier id'>the_name</span><span class='dot token'>.</span><span class='downcase identifier id'>downcase</span>
        <span class='return return kw'>return</span> <span class='child identifier id'>child</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='else else kw'>else</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='loop_items identifier id'>loop_items</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='item identifier id'>item</span><span class='bitor op'>|</span>
      <span class='if if kw'>if</span> <span class='item identifier id'>item</span><span class='dot token'>.</span><span class='item_name identifier id'>item_name</span><span class='lparen token'>(</span><span class='default_language identifier id'>default_language</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='downcase identifier id'>downcase</span> <span class='eq op'>==</span> <span class='the_name identifier id'>the_name</span><span class='dot token'>.</span><span class='downcase identifier id'>downcase</span>
        <span class='return return kw'>return</span> <span class='item identifier id'>item</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='nil nil kw'>nil</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_bottom_boundary-instance_method">
  
    - (<tt>Object</tt>) <strong>get_bottom_boundary</strong>(section) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
get the first occurrence of an item of self.loop_source that is a
descendant of section
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


44
45
46</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/loop_item_type.rb', line 44</span>

<span class='def def kw'>def</span> <span class='get_bottom_boundary identifier id'>get_bottom_boundary</span><span class='lparen token'>(</span><span class='section identifier id'>section</span><span class='rparen token'>)</span>
  <span class='lparen token'>(</span> <span class='notop op'>!</span><span class='section identifier id'>section</span><span class='dot token'>.</span><span class='children identifier id'>children</span> <span class='orop op'>||</span> <span class='section identifier id'>section</span><span class='dot token'>.</span><span class='leaf? fid id'>leaf?</span> <span class='rparen token'>)</span> <span class='question op'>?</span> <span class='nil nil kw'>nil</span> <span class='colon op'>:</span> <span class='section identifier id'>section</span><span class='dot token'>.</span><span class='descendant_item_type identifier id'>descendant_item_type</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_upper_boundary-instance_method">
  
    - (<tt>Object</tt>) <strong>get_upper_boundary</strong>(section) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
get the first occurrence of an item of self.loop_source that is an ancestor
of section
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


30
31
32
33
34
35
36</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/loop_item_type.rb', line 30</span>

<span class='def def kw'>def</span> <span class='get_upper_boundary identifier id'>get_upper_boundary</span><span class='lparen token'>(</span><span class='section identifier id'>section</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='section identifier id'>section</span><span class='dot token'>.</span><span class='matching_loop_sources? fid id'>matching_loop_sources?</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span>
    <span class='section identifier id'>section</span><span class='dot token'>.</span><span class='loop_item_type identifier id'>loop_item_type</span>
  <span class='else else kw'>else</span>
    <span class='section identifier id'>section</span><span class='dot token'>.</span><span class='root? fid id'>root?</span> <span class='integer val'>? </span><span class='nil nil kw'>nil</span> <span class='colon op'>:</span> <span class='notop op'>!</span><span class='section identifier id'>section</span><span class='dot token'>.</span><span class='parent identifier id'>parent</span> <span class='integer val'>? </span> <span class='nil nil kw'>nil</span> <span class='colon op'>:</span> <span class='section identifier id'>section</span><span class='dot token'>.</span><span class='parent identifier id'>parent</span><span class='dot token'>.</span><span class='first_ancestor_item_type identifier id'>first_ancestor_item_type</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_upper_boundary_when_editing-instance_method">
  
    - (<tt>Object</tt>) <strong>get_upper_boundary_when_editing</strong>(section) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
get the first occurrence of an item of self.loop_source that is an ancestor
of section | for when editing a section.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


39
40
41</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/loop_item_type.rb', line 39</span>

<span class='def def kw'>def</span> <span class='get_upper_boundary_when_editing identifier id'>get_upper_boundary_when_editing</span><span class='lparen token'>(</span><span class='section identifier id'>section</span><span class='rparen token'>)</span>
  <span class='notop op'>!</span><span class='section identifier id'>section</span><span class='dot token'>.</span><span class='parent identifier id'>parent</span> <span class='integer val'>? </span><span class='nil nil kw'>nil</span> <span class='colon op'>:</span> <span class='section identifier id'>section</span><span class='dot token'>.</span><span class='parent identifier id'>parent</span><span class='dot token'>.</span><span class='first_ancestor_item_type identifier id'>first_ancestor_item_type</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="handle_source-instance_method">
  
    - (<tt>Object</tt>) <strong>handle_source</strong>(file_path, status) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/loop_item_type.rb', line 107</span>

<span class='def def kw'>def</span> <span class='handle_source identifier id'>handle_source</span> <span class='file_path identifier id'>file_path</span><span class='comma token'>,</span> <span class='status identifier id'>status</span>
  <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:line</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='comment val'>#get the default language of the questionnaire</span>
  <span class='default_lang identifier id'>default_lang</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='root identifier id'>root</span><span class='dot token'>.</span><span class='loop_source identifier id'>loop_source</span><span class='dot token'>.</span><span class='questionnaire identifier id'>questionnaire</span><span class='dot token'>.</span><span class='questionnaire_fields identifier id'>questionnaire_fields</span><span class='dot token'>.</span><span class='find_by_is_default_language identifier id'>find_by_is_default_language</span><span class='lparen token'>(</span><span class='true true kw'>true</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='language identifier id'>language</span>
  <span class='begin begin kw'>begin</span>
    <span class='comment val'>#read the file into a table</span>
    <span class='table identifier id'>table</span> <span class='assign token'>=</span> <span class='FasterCSV constant id'>FasterCSV</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='file_path identifier id'>file_path</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='symbol val'>:quote_char</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'&quot;'</span><span class='comma token'>,</span> <span class='symbol val'>:col_sep</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='string val'>','</span><span class='comma token'>,</span> <span class='symbol val'>:row_sep</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:auto</span><span class='comma token'>,</span> <span class='symbol val'>:headers</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:first_row</span><span class='comma token'>,</span> <span class='symbol val'>:encoding</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;`Uâ€™&quot;</span><span class='rbrace token'>}</span><span class='rparen token'>)</span> <span class='comment val'>#:encoding =&gt; &quot;`Uâ€™&quot;})</span>
  <span class='rescue rescue kw'>rescue</span> <span class='Exception constant id'>Exception</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
    <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:errors</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='e identifier id'>e</span><span class='dot token'>.</span><span class='message identifier id'>message</span>
    <span class='return return kw'>return</span> <span class='false false kw'>false</span>
  <span class='end end kw'>end</span>
  <span class='comment val'>#check if the headers of the file are OK.</span>
  <span class='comment val'>#OK if the first char is a &quot;#&quot;, if the first element is the name of the loop item type, and if the following header items are one of the UN languages</span>
  <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='source_headers_ok? fid id'>source_headers_ok?</span><span class='lparen token'>(</span><span class='table identifier id'>table</span><span class='dot token'>.</span><span class='headers identifier id'>headers</span><span class='dot token'>.</span><span class='to_a identifier id'>to_a</span><span class='comma token'>,</span> <span class='status identifier id'>status</span><span class='rparen token'>)</span>
    <span class='return return kw'>return</span> <span class='false false kw'>false</span>
  <span class='end end kw'>end</span>
  <span class='comment val'>#parse the file, row by row</span>
  <span class='table identifier id'>table</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='row identifier id'>row</span><span class='bitor op'>|</span>
    <span class='comment val'>#keep track of the line number</span>
    <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:line</span><span class='rbrack token'>]</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
    <span class='comment val'>#convert the row to an array</span>
    <span class='row_as_a identifier id'>row_as_a</span> <span class='assign token'>=</span> <span class='row identifier id'>row</span><span class='dot token'>.</span><span class='to_a identifier id'>to_a</span>
    <span class='if if kw'>if</span> <span class='row_as_a identifier id'>row_as_a</span><span class='dot token'>.</span><span class='present? fid id'>present?</span>
      <span class='comment val'>#the_name = row_as_a[0][1].strip</span>
      <span class='comment val'>#cd = CharDet.detect(the_name)</span>
      <span class='item_name_utf8 identifier id'>item_name_utf8</span> <span class='assign token'>=</span> <span class='row_as_a identifier id'>row_as_a</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span> <span class='comment val'># (cd['confidence'] &gt; 0.9 &amp;&amp; cd['confidence'] &lt; 1) ? Iconv.iconv('utf-8', cd['encoding'], the_name) : the_name</span>
      <span class='comment val'>#check if there's a loop_item_names with the value of the first column of each row</span>
      <span class='loop_item_name identifier id'>loop_item_name</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='loop_item_name_fields identifier id'>loop_item_name_fields</span><span class='dot token'>.</span><span class='find_by_item_name_and_language identifier id'>find_by_item_name_and_language</span><span class='lparen token'>(</span><span class='item_name_utf8 identifier id'>item_name_utf8</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='default_lang identifier id'>default_lang</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='try identifier id'>try</span><span class='lparen token'>(</span><span class='symbol val'>:loop_item_name</span><span class='rparen token'>)</span><span class='comment val'>#row_as_a[0][1])</span>
      <span class='comment val'>#if not, return with info about the error</span>
      <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='loop_item_name identifier id'>loop_item_name</span>
        <span class='comment val'>#ignore errors and continue</span>
        <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:errors</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;ERROR: Line number #{status[:line]}. There is no loop item by the name of: #{item_name_utf8}&quot;</span>
        <span class='comment val'>#return false</span>
        <span class='next next kw'>next</span>
      <span class='end end kw'>end</span>
      <span class='comment val'>#remove the first column</span>
      <span class='row_as_a identifier id'>row_as_a</span><span class='dot token'>.</span><span class='delete_at identifier id'>delete_at</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='rparen token'>)</span>
      <span class='comment val'>#add the extra_fields to the item_extras object. Storing the language</span>
      <span class='row_as_a identifier id'>row_as_a</span><span class='dot token'>.</span><span class='each_index identifier id'>each_index</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='i identifier id'>i</span><span class='bitor op'>|</span> <span class='comment val'>#row_as_a[i][0] =&gt; header; row_as_a[i][1] =&gt; value</span>
        <span class='if if kw'>if</span> <span class='row_as_a identifier id'>row_as_a</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='present? fid id'>present?</span> <span class='comment val'>#if there's no name, there's no item</span>
          <span class='the_val identifier id'>the_val</span><span class='assign token'>=</span><span class='row_as_a identifier id'>row_as_a</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span>
          <span class='the_lang identifier id'>the_lang</span> <span class='assign token'>=</span> <span class='row_as_a identifier id'>row_as_a</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span>
          <span class='comment val'>#check if  there's already a item_extra_field with the current language:  if not, create it and then update the values.</span>
          <span class='loop_item_name_field identifier id'>loop_item_name_field</span> <span class='assign token'>=</span> <span class='loop_item_name identifier id'>loop_item_name</span><span class='dot token'>.</span><span class='loop_item_name_fields identifier id'>loop_item_name_fields</span><span class='dot token'>.</span><span class='find_or_create_by_language identifier id'>find_or_create_by_language</span><span class='lparen token'>(</span><span class='the_lang identifier id'>the_lang</span><span class='rparen token'>)</span><span class='comment val'>#lang_utf8.to_s)#</span>
          <span class='loop_item_name_field identifier id'>loop_item_name_field</span><span class='dot token'>.</span><span class='is_default_language identifier id'>is_default_language</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='default_lang identifier id'>default_lang</span> <span class='eq op'>==</span> <span class='the_lang identifier id'>the_lang</span><span class='rparen token'>)</span><span class='comment val'>#lang_utf8.to_s)#</span>
          <span class='loop_item_name_field identifier id'>loop_item_name_field</span><span class='dot token'>.</span><span class='item_name identifier id'>item_name</span> <span class='assign token'>=</span> <span class='the_val identifier id'>the_val</span>
          <span class='begin begin kw'>begin</span>
            <span class='loop_item_name_field identifier id'>loop_item_name_field</span><span class='dot token'>.</span><span class='save! fid id'>save!</span>
          <span class='rescue rescue kw'>rescue</span>
            <span class='cd identifier id'>cd</span> <span class='assign token'>=</span> <span class='CharDet constant id'>CharDet</span><span class='dot token'>.</span><span class='detect identifier id'>detect</span><span class='lparen token'>(</span><span class='the_val identifier id'>the_val</span><span class='rparen token'>)</span>
            <span class='loop_item_name_field identifier id'>loop_item_name_field</span><span class='dot token'>.</span><span class='item_name identifier id'>item_name</span> <span class='assign token'>=</span> <span class='Iconv constant id'>Iconv</span><span class='dot token'>.</span><span class='iconv identifier id'>iconv</span><span class='lparen token'>(</span><span class='string val'>'utf-8'</span><span class='comma token'>,</span> <span class='cd identifier id'>cd</span><span class='lbrack token'>[</span><span class='string val'>'encoding'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='the_val identifier id'>the_val</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
            <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='loop_item_name_field identifier id'>loop_item_name_field</span><span class='dot token'>.</span><span class='save! fid id'>save!</span>
              <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:errors</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;ERROR: Line number #{status[:line]}: please check the character encoding of your file.&quot;</span>
            <span class='end end kw'>end</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='true true kw'>true</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="in_bounds?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>in_bounds?</strong>(upper_boundary) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
check if a loop_item_type is inside the upper and bottom boundary for a
specific section.
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


49
50
51</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/loop_item_type.rb', line 49</span>

<span class='def def kw'>def</span> <span class='in_bounds? fid id'>in_bounds?</span><span class='lparen token'>(</span><span class='upper_boundary identifier id'>upper_boundary</span><span class='rparen token'>)</span>
  <span class='notop op'>!</span><span class='upper_boundary identifier id'>upper_boundary</span> <span class='orop op'>||</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='is_descendant_of? fid id'>is_descendant_of?</span><span class='lparen token'>(</span><span class='upper_boundary identifier id'>upper_boundary</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="in_bounds_when_editing?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>in_bounds_when_editing?</strong>(bottom_boundary, upper_boundary) 
  

  
</p><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


53
54
55
56
57
58
59
60
61
62
63
64
65</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/loop_item_type.rb', line 53</span>

<span class='def def kw'>def</span> <span class='in_bounds_when_editing? fid id'>in_bounds_when_editing?</span><span class='lparen token'>(</span><span class='bottom_boundary identifier id'>bottom_boundary</span><span class='comma token'>,</span> <span class='upper_boundary identifier id'>upper_boundary</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='upper_boundary identifier id'>upper_boundary</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='bottom_boundary identifier id'>bottom_boundary</span>  <span class='comment val'>#if both are nil return true</span>
    <span class='return return kw'>return</span> <span class='true true kw'>true</span>
  <span class='elsif elsif kw'>elsif</span> <span class='upper_boundary identifier id'>upper_boundary</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='bottom_boundary identifier id'>bottom_boundary</span> <span class='andop op'>&amp;&amp;</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='is_descendant_of? fid id'>is_descendant_of?</span><span class='lparen token'>(</span><span class='upper_boundary identifier id'>upper_boundary</span><span class='rparen token'>)</span>
    <span class='return return kw'>return</span> <span class='true true kw'>true</span>
  <span class='elsif elsif kw'>elsif</span> <span class='notop op'>!</span><span class='upper_boundary identifier id'>upper_boundary</span> <span class='andop op'>&amp;&amp;</span> <span class='bottom_boundary identifier id'>bottom_boundary</span> <span class='andop op'>&amp;&amp;</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='is_ancestor_of? fid id'>is_ancestor_of?</span><span class='lparen token'>(</span><span class='bottom_boundary identifier id'>bottom_boundary</span><span class='rparen token'>)</span>
    <span class='return return kw'>return</span> <span class='true true kw'>true</span>
  <span class='elsif elsif kw'>elsif</span> <span class='upper_boundary identifier id'>upper_boundary</span> <span class='andop op'>&amp;&amp;</span> <span class='bottom_boundary identifier id'>bottom_boundary</span> <span class='andop op'>&amp;&amp;</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='is_descendant_of? fid id'>is_descendant_of?</span><span class='lparen token'>(</span><span class='upper_boundary identifier id'>upper_boundary</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='is_ancestor_of? fid id'>is_ancestor_of?</span><span class='lparen token'>(</span><span class='bottom_boundary identifier id'>bottom_boundary</span><span class='rparen token'>)</span>
    <span class='return return kw'>return</span> <span class='true true kw'>true</span>
  <span class='else else kw'>else</span>
    <span class='return return kw'>return</span> <span class='false false kw'>false</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="is_filtering_field?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>is_filtering_field?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


67
68
69</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/loop_item_type.rb', line 67</span>

<span class='def def kw'>def</span> <span class='is_filtering_field? fid id'>is_filtering_field?</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='filtering_field identifier id'>filtering_field</span><span class='dot token'>.</span><span class='present? fid id'>present?</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="leaf_loop_items_sorted-instance_method">
  
    - (<tt>Object</tt>) <strong>leaf_loop_items_sorted</strong>(params) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


194
195
196
197
198
199
200
201</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/loop_item_type.rb', line 194</span>

<span class='def def kw'>def</span> <span class='leaf_loop_items_sorted identifier id'>leaf_loop_items_sorted</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:sord</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>&quot;asc&quot;</span>
    <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='loop_items identifier id'>loop_items</span><span class='dot token'>.</span><span class='sort identifier id'>sort</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='a identifier id'>a</span><span class='comma token'>,</span> <span class='b identifier id'>b</span><span class='bitor op'>|</span> <span class='a identifier id'>a</span><span class='dot token'>.</span><span class='item_name identifier id'>item_name</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:language</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='cmp op'>&lt;=&gt;</span> <span class='b identifier id'>b</span><span class='dot token'>.</span><span class='item_name identifier id'>item_name</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:language</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rbrace token'>}</span>
  <span class='else else kw'>else</span>
    <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='loop_items identifier id'>loop_items</span><span class='dot token'>.</span><span class='sort identifier id'>sort</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='a identifier id'>a</span><span class='comma token'>,</span> <span class='b identifier id'>b</span><span class='bitor op'>|</span> <span class='b identifier id'>b</span><span class='dot token'>.</span><span class='item_name identifier id'>item_name</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:language</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='cmp op'>&lt;=&gt;</span> <span class='a identifier id'>a</span><span class='dot token'>.</span><span class='item_name identifier id'>item_name</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:language</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='leaf? fid id'>leaf?</span> <span class='integer val'>? </span><span class='result identifier id'>result</span> <span class='colon op'>:</span> <span class='result identifier id'>result</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='a identifier id'>a</span><span class='bitor op'>|</span> <span class='a identifier id'>a</span><span class='dot token'>.</span><span class='leaves identifier id'>leaves</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="loop_item_name_with-instance_method">
  
    - (<tt>Object</tt>) <strong>loop_item_name_with</strong>(the_name, default_language) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Fetches the LoopItemName that has a a loop_item_name_field with item_name
as &#8216;the_name&#8217; Passes in the default language to specify if a
new LoopItemNameField needs to be created
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/loop_item_type.rb', line 205</span>

<span class='def def kw'>def</span> <span class='loop_item_name_with identifier id'>loop_item_name_with</span> <span class='the_name identifier id'>the_name</span><span class='comma token'>,</span> <span class='default_language identifier id'>default_language</span>
  <span class='comment val'>#l_item_name = item_types[row_as_a[i][0].to_s].loop_item_names.find_by_item_name(row_as_a[i][1].to_s)</span>
  <span class='begin begin kw'>begin</span>
    <span class='the_l_item_name_field identifier id'>the_l_item_name_field</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='loop_item_name_fields identifier id'>loop_item_name_fields</span><span class='dot token'>.</span><span class='find_by_item_name identifier id'>find_by_item_name</span><span class='lparen token'>(</span><span class='the_name identifier id'>the_name</span><span class='rparen token'>)</span>
  <span class='rescue rescue kw'>rescue</span>
    <span class='cd identifier id'>cd</span> <span class='assign token'>=</span> <span class='CharDet constant id'>CharDet</span><span class='dot token'>.</span><span class='detect identifier id'>detect</span><span class='lparen token'>(</span><span class='the_name identifier id'>the_name</span><span class='rparen token'>)</span>
    <span class='the_l_item_name_field identifier id'>the_l_item_name_field</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='loop_item_name_fields identifier id'>loop_item_name_fields</span><span class='dot token'>.</span><span class='find_by_item_name identifier id'>find_by_item_name</span><span class='lparen token'>(</span><span class='Iconv constant id'>Iconv</span><span class='dot token'>.</span><span class='iconv identifier id'>iconv</span><span class='lparen token'>(</span><span class='string val'>'utf-8'</span><span class='comma token'>,</span> <span class='cd identifier id'>cd</span><span class='lbrack token'>[</span><span class='string val'>'encoding'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='the_name identifier id'>the_name</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='l_item_name identifier id'>l_item_name</span> <span class='assign token'>=</span> <span class='the_l_item_name_field identifier id'>the_l_item_name_field</span><span class='dot token'>.</span><span class='present? fid id'>present?</span> <span class='integer val'>? </span><span class='the_l_item_name_field identifier id'>the_l_item_name_field</span><span class='dot token'>.</span><span class='loop_item_name identifier id'>loop_item_name</span> <span class='colon op'>:</span> <span class='nil nil kw'>nil</span>
  <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='l_item_name identifier id'>l_item_name</span>
    <span class='l_item_name identifier id'>l_item_name</span> <span class='assign token'>=</span> <span class='LoopItemName constant id'>LoopItemName</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='rparen token'>)</span><span class='comment val'>#:item_name =&gt; row_as_a[i][1].to_s</span>
    <span class='l_item_name_field identifier id'>l_item_name_field</span> <span class='assign token'>=</span> <span class='LoopItemNameField constant id'>LoopItemNameField</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:item_name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='the_name identifier id'>the_name</span><span class='comma token'>,</span> <span class='symbol val'>:language</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='default_language identifier id'>default_language</span><span class='comma token'>,</span> <span class='symbol val'>:is_default_language</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>
    <span class='begin begin kw'>begin</span>
      <span class='l_item_name_field identifier id'>l_item_name_field</span><span class='dot token'>.</span><span class='save! fid id'>save!</span>
    <span class='rescue rescue kw'>rescue</span>
      <span class='cd identifier id'>cd</span> <span class='opasgn op'>||=</span> <span class='CharDet constant id'>CharDet</span><span class='dot token'>.</span><span class='detect identifier id'>detect</span><span class='lparen token'>(</span><span class='the_name identifier id'>the_name</span><span class='rparen token'>)</span>
      <span class='l_item_name_field identifier id'>l_item_name_field</span><span class='dot token'>.</span><span class='item_name identifier id'>item_name</span> <span class='assign token'>=</span> <span class='Iconv constant id'>Iconv</span><span class='dot token'>.</span><span class='iconv identifier id'>iconv</span><span class='lparen token'>(</span><span class='string val'>'utf-8'</span><span class='comma token'>,</span> <span class='cd identifier id'>cd</span><span class='lbrack token'>[</span><span class='string val'>'encoding'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='the_name identifier id'>the_name</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
      <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='l_item_name_field identifier id'>l_item_name_field</span><span class='dot token'>.</span><span class='save! fid id'>save!</span>
        <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:errors</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;ERROR: line #{status[:line]} and column #{status[:column]}. Check the character encoding of your file.&quot;</span>
        <span class='return return kw'>return</span> <span class='false false kw'>false</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='l_item_name identifier id'>l_item_name</span><span class='dot token'>.</span><span class='loop_item_name_fields identifier id'>loop_item_name_fields</span> <span class='lshft op'>&lt;&lt;</span> <span class='l_item_name_field identifier id'>l_item_name_field</span>
    <span class='l_item_name identifier id'>l_item_name</span><span class='dot token'>.</span><span class='save! fid id'>save!</span>
  <span class='end end kw'>end</span>
  <span class='l_item_name identifier id'>l_item_name</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="source_headers_ok?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>source_headers_ok?</strong>(header_row, status) 
  

  
</p><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/loop_item_type.rb', line 169</span>

<span class='def def kw'>def</span> <span class='source_headers_ok? fid id'>source_headers_ok?</span> <span class='header_row identifier id'>header_row</span><span class='comma token'>,</span> <span class='status identifier id'>status</span>
  <span class='comment val'>#check if headers are present: Headers/Title line should start with &quot;#&quot;</span>
  <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='lbrack token'>[</span><span class='string val'>'#'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='header_row identifier id'>header_row</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='comma token'>,</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:errors</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;ERROR: Header row is not properly defined. Should start with a # character.&quot;</span>
    <span class='return return kw'>return</span> <span class='false false kw'>false</span>
  <span class='else else kw'>else</span>
    <span class='comment val'>#remove the '#' character, since it is no longer needed</span>
    <span class='header_row identifier id'>header_row</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='slice! fid id'>slice!</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='rparen token'>)</span>
    <span class='if if kw'>if</span> <span class='header_row identifier id'>header_row</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span><span class='dot token'>.</span><span class='downcase identifier id'>downcase</span> <span class='neq op'>!=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='dot token'>.</span><span class='downcase identifier id'>downcase</span>
      <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:errors</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;ERROR: Header row. First element must be the type of the loop items.&quot;</span>
      <span class='return return kw'>return</span> <span class='false false kw'>false</span>
    <span class='else else kw'>else</span>
      <span class='header_row identifier id'>header_row</span><span class='dot token'>.</span><span class='delete_at identifier id'>delete_at</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
    <span class='header_row identifier id'>header_row</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='header identifier id'>header</span><span class='bitor op'>|</span>
      <span class='languages identifier id'>languages</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='root identifier id'>root</span><span class='dot token'>.</span><span class='loop_source identifier id'>loop_source</span><span class='dot token'>.</span><span class='questionnaire identifier id'>questionnaire</span><span class='dot token'>.</span><span class='questionnaire_fields identifier id'>questionnaire_fields</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='a identifier id'>a</span><span class='bitor op'>|</span> <span class='a identifier id'>a</span><span class='dot token'>.</span><span class='language identifier id'>language</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span><span class='rbrace token'>}</span>
      <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='languages identifier id'>languages</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='header identifier id'>header</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span><span class='rparen token'>)</span>
        <span class='status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:errors</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;ERROR: Header row. The loop items name values can only be defined in the languages of the questionnaire. (#{languages.join(', ')}).&quot;</span>
        <span class='return return kw'>return</span> <span class='false false kw'>false</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='true true kw'>true</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Fri Jul  8 14:33:32 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.2 (ruby-1.8.7).
</div>

  </body>
</html>