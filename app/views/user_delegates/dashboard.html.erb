<div class="span-24 last" id="content" style="display: block">
  <h1><%=t('user_dashboard.welcome_msg')%> <%= h(@delegate.full_name)%></h1>
  <div class="span-24 last">
    <% if @delegated_tasks.present? -%>
      <h3><%= t('delegate_dashboard.title')%></h3>
      <div id="q_dashboard">
        <% @delegated_tasks.each do |delegation| -%>
          <p><strong><%=t('generic.questionnaire')%></strong><%= link_to h(delegation.questionnaire.title), submission_questionnaire_path(delegation.questionnaire, user_delegate: delegation.user_delegate_id) %></p>
          <p><strong><%=t('generic.delegator')%></strong> <%= h delegation.user.full_name %></p>
          <p><strong><%=t('delegate_dashboard.delegator_remarks')%></strong><%= delegation.remarks.present? ? h(delegation.remarks) : "-" %></p>
          <p><strong><%=t('generic.details')%></strong>
          <% if delegation.sections.present? -%>
            <%= pluralize(delegation.sections.count, "section")%> <%= t('delegate_dashboard.to_fill') %> <a href="#" id="show_details_<%= delegation.id %>"><%=t('generic.details')%></a>
          <% else -%>
            <%= t('delegate_dashboard.fill_all') %>
          <% end -%>
          </p>
          <% if delegation.sections.present? %>
            <div id="delegation_details_<%= delegation.id %>" class="hide">
              <table>
                <thead>
                  <tr>
                    <th><%= t('generic.section')%></th>
                    <th><%= t('delegation_details.root_section_th')%></th>
                    <th><%= t('delegation_details.loop_th')%></th>
                  </tr>
                </thead>
                <tbody>
                  <% delegation.delegation_sections.each do |delegation_section| -%>
                    <tr>
                      <td><%= OrtSanitize.white_space_cleanse(delegation_section.section.value_in((delegation_section.section.root? ? :tab_title : :title), current_user.language)) %></td>
                      <td><%= OrtSanitize.white_space_cleanse(delegation_section.section.root.value_in(:tab_title, current_user.language))%></td>
                      <td><%= delegation_section.loop_item_names.map{|loop_item_name| h(loop_item_name.item_name(current_user.language))}.join(', ') %></td>
                    </tr>
                  <% end -%>
                </tbody>
              </table>
            </div>
          <% end -%>
          <hr />
        <% end -%>
      </div>
    <% else -%>
      <p><%=t('delegate_dashboard.no_tasks')%></p>
    <% end -%>
  </div>
  <%= render :partial => "layouts/institutions" %>
</div><!-- /content -->
<script type="text/javascript">
    <% @delegated_tasks.each do |delegation| -%>
        <% if delegation.sections.present? %>
            $("#show_details_<%= delegation.id %>").click(function(e){
               e.preventDefault();
                $("#delegation_details_<%= delegation.id %>").toggle('slow');
            });
        <% end -%>
    <% end -%>
</script>
